"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[188],{6807:(e,s,a)=>{a.d(s,{E:()=>w});var r=a(4568),t=a(1773),c=a(7620),n=a(7227),l=a(3353),i=a(5165),d=a(2555),m=a(4148),x=a(9594),o=a(5191),h=a(3185),u=a(5774),j=a(9513),p=a(9690),y=a(5945),N=a(2055),f=a(5173),g=a(9369),v=a(8276),b=a(7277),C=a(6257);function w(e){let{transferData:s,onRecipientSelected:a,onBack:w,currentUserId:k,isLoading:A=!1}=e,[S,P]=(0,c.useState)(""),[L,E]=(0,c.useState)([]),[F,R]=(0,c.useState)(!1),[Z,_]=(0,c.useState)(null),[D,T]=(0,c.useState)(!1),[W,U]=(0,c.useState)([]),[M,B]=(0,c.useState)(!1),[I,$]=(0,c.useState)(null),[z,V]=(0,c.useState)(null),[Y,q]=(0,c.useState)(null),[J,O]=(0,c.useState)("recent");(0,c.useEffect)(()=>{k&&G()},[k]),(0,c.useEffect)(()=>{if(S.trim().length>=2){let e=setTimeout(()=>{H(S.trim())},500);return()=>clearTimeout(e)}E([]),T(!1),_(null)},[S]);let G=(0,c.useCallback)(async()=>{if(k){B(!0),$(null);try{let e=await fetch("".concat("http://localhost:4000","/api/users/me/recipients"),{headers:{Authorization:"Bearer ".concat(await K()),"Content-Type":"application/json"}});if(!e.ok)throw Error("Failed to load recent recipients");let s=await e.json();U(s.recipients||[])}catch(e){console.error("Error loading recent recipients:",e),$("Failed to load recent recipients"),U([])}finally{B(!1)}}},[k]),H=(0,c.useCallback)(async e=>{R(!0),_(null);try{let a=new URLSearchParams({q:e,currency:s.receiveCurrency,limit:"10"});"CLP"===s.receiveCurrency&&a.append("country","CL");let r=await fetch("".concat("http://localhost:4000","/api/users/search?").concat(a),{headers:{Authorization:"Bearer ".concat(await K()),"Content-Type":"application/json"}});if(!r.ok)throw Error("Failed to search users");let t=(await r.json()).users.filter(e=>e.id!==k&&("CLP"!==s.receiveCurrency||e.verifiedPaymentMethods.some(e=>"CLP"===e.currency&&"CL"===e.country)));E(t),T(!0)}catch(e){console.error("Error searching users:",e),_("Failed to search users. Please try again."),E([])}finally{R(!1)}},[s.receiveCurrency,k]),K=async()=>{try{return sessionStorage.getItem("__clerk_token")||localStorage.getItem("__clerk_token")||"mock-token"}catch(e){return console.warn("Failed to get auth token:",e),"mock-token"}},Q=e=>{V(e);let a=e.verifiedPaymentMethods.filter(e=>e.currency===s.receiveCurrency),r=a.find(e=>e.isDefault)||a[0];r&&q(r)},X=e=>{q(e)},ee=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=arguments.length>2?arguments[2]:void 0,n=e.verifiedPaymentMethods.filter(e=>e.currency===s.receiveCurrency),i=(null==z?void 0:z.id)===e.id,d="CLP"===s.receiveCurrency,p=d?(0,C.formatChileanUserDisplay)(e):null;return(0,r.jsx)(l.Zp,{className:"cursor-pointer transition-all hover:shadow-md ".concat(i?"ring-2 ring-blue-500 bg-blue-50":""),onClick:()=>Q(e),children:(0,r.jsx)(l.Wu,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:e.profileImageUrl?(0,r.jsx)(t.default,{src:e.profileImageUrl,alt:(null==p?void 0:p.displayName)||e.fullName,width:48,height:48,className:"w-12 h-12 rounded-full object-cover"}):(0,r.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center",children:(0,r.jsx)(x.A,{className:"w-6 h-6 text-gray-500"})})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:(null==p?void 0:p.displayName)||e.fullName}),e.isVerified&&(0,r.jsx)(o.A,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),a&&(null==c?void 0:c.isFavorite)&&(0,r.jsx)(h.A,{className:"w-4 h-4 text-yellow-500 flex-shrink-0"})]}),((null==p?void 0:p.subtitle)||e.email||e.username)&&(0,r.jsx)("div",{className:"flex items-center space-x-4 text-xs text-gray-500 mb-2",children:(null==p?void 0:p.subtitle)?(0,r.jsx)("span",{className:"truncate",children:p.subtitle}):(0,r.jsxs)(r.Fragment,{children:[e.email&&(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)(u.A,{className:"w-3 h-3"}),(0,r.jsx)("span",{className:"truncate",children:e.email})]}),e.username&&(0,r.jsx)("div",{className:"flex items-center space-x-1",children:(0,r.jsxs)("span",{children:["@",e.username]})})]})}),a&&c&&(0,r.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500 mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)(j.A,{className:"w-3 h-3"}),(0,r.jsxs)("span",{children:["Last: ",new Date(c.lastTransferAt).toLocaleDateString()]})]}),(0,r.jsxs)("div",{children:[c.transferCount," transfer",1!==c.transferCount?"s":""]})]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-1 mb-2",children:d&&(null==p?void 0:p.badges)?p.badges.map((e,s)=>(0,r.jsx)(m.E,{variant:e.includes("CLP")?"default":"secondary",className:"text-xs",children:e},s)):e.supportedCurrencies.map(e=>(0,r.jsx)(m.E,{variant:e===s.receiveCurrency?"default":"secondary",className:"text-xs",children:e},e))}),n.length>0?(0,r.jsxs)("div",{className:"text-xs text-green-600",children:["✓ ",n.length," verified account",1!==n.length?"s":""," for ",s.receiveCurrency,d&&(0,r.jsx)("span",{className:"ml-1",children:"(Chilean bank)"})]}):(0,r.jsxs)("div",{className:"text-xs text-red-600",children:["✗ No verified accounts for ",s.receiveCurrency,d&&(0,r.jsx)("span",{className:"ml-1",children:"(Need Chilean bank account)"})]})]})]})})},e.id)};return(0,r.jsxs)("div",{className:"w-full max-w-4xl mx-auto space-y-6",children:[(0,r.jsx)(l.Zp,{children:(0,r.jsxs)(l.aR,{children:[(0,r.jsxs)(l.ZB,{className:"flex items-center space-x-2",children:[(0,r.jsx)(N.A,{className:"h-5 w-5"}),(0,r.jsx)("span",{children:"Send to User"})]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Send ",s.sendAmount," ",s.sendCurrency," to a registered user"]})]})}),(0,r.jsx)(l.Zp,{className:"bg-gray-50",children:(0,r.jsxs)(l.Wu,{className:"p-4",children:[(0,r.jsx)("h3",{className:"font-semibold mb-2",children:"Transfer Summary"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"You Send:"}),(0,r.jsxs)("span",{className:"font-medium",children:[s.sendAmount," ",s.sendCurrency]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"They Receive:"}),(0,r.jsxs)("span",{className:"font-medium",children:[s.receiveAmount," ",s.receiveCurrency]})]}),(0,r.jsxs)("div",{className:"flex justify-between col-span-2",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Exchange Rate:"}),(0,r.jsxs)("span",{className:"font-medium",children:["1 ",s.sendCurrency," = ",s.exchangeRate.toFixed(4)," ",s.receiveCurrency]})]})]})]})}),(0,r.jsxs)("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[(0,r.jsxs)("button",{className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat("recent"===J?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),onClick:()=>O("recent"),children:[(0,r.jsx)(j.A,{className:"w-4 h-4 inline mr-2"}),"Recent Recipients"]}),(0,r.jsxs)("button",{className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat("search"===J?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),onClick:()=>O("search"),children:[(0,r.jsx)(f.A,{className:"w-4 h-4 inline mr-2"}),"Search Users"]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:["search"===J&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"user-search",children:"CLP"===s.receiveCurrency?"Search Chilean users by username, email, or phone":"Search by email, username, or phone"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(f.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,r.jsx)(i.p,{id:"user-search",placeholder:"CLP"===s.receiveCurrency?"Enter username, email, or phone number...":"Enter email, username, or phone number...",className:"pl-10",value:S,onChange:e=>P(e.target.value)}),F&&(0,r.jsx)(g.A,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 animate-spin text-gray-400"})]}),"CLP"===s.receiveCurrency&&(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Only showing Chilean users with verified CLP bank accounts"})]}),Z&&(0,r.jsx)(l.Zp,{className:"border-red-200 bg-red-50",children:(0,r.jsx)(l.Wu,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-red-700",children:[(0,r.jsx)(p.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:Z})]})})}),D&&!F&&0===L.length&&!Z&&(0,r.jsx)(l.Zp,{children:(0,r.jsxs)(l.Wu,{className:"p-8 text-center",children:[(0,r.jsx)(N.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No users found"}),(0,r.jsx)("p",{className:"text-gray-600",children:"CLP"===s.receiveCurrency?'No Chilean users found matching "'.concat(S,'" with verified CLP bank accounts. Try a different search term.'):'No users found matching "'.concat(S,'". Try a different search term.')})]})}),L.length>0&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("h3",{className:"text-sm font-medium text-gray-700",children:["Search Results (",L.length,")"]}),L.map(e=>ee(e))]})]}),"recent"===J&&(0,r.jsxs)(r.Fragment,{children:[I&&(0,r.jsx)(l.Zp,{className:"border-red-200 bg-red-50",children:(0,r.jsx)(l.Wu,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-red-700",children:[(0,r.jsx)(p.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:I})]})})}),M?(0,r.jsx)(l.Zp,{children:(0,r.jsxs)(l.Wu,{className:"p-8 text-center",children:[(0,r.jsx)(g.A,{className:"w-8 h-8 animate-spin text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading recent recipients..."})]})}):0===W.length?(0,r.jsx)(l.Zp,{children:(0,r.jsxs)(l.Wu,{className:"p-8 text-center",children:[(0,r.jsx)(j.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No recent recipients"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"You haven't sent money to any users yet. Use the search tab to find someone to send money to."}),(0,r.jsxs)(n.$,{variant:"outline",onClick:()=>O("search"),children:[(0,r.jsx)(f.A,{className:"w-4 h-4 mr-2"}),"Search Users"]})]})}):(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("h3",{className:"text-sm font-medium text-gray-700",children:["Recent Recipients (",W.length,")"]}),W.map(e=>ee(e.userProfile,!0,e))]})]})]}),z&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Selected Recipient"}),ee(z),(()=>{if(!z)return null;let e=z.verifiedPaymentMethods.filter(e=>e.currency===s.receiveCurrency);return 0===e.length?(0,r.jsx)(l.Zp,{className:"border-red-200 bg-red-50",children:(0,r.jsxs)(l.Wu,{className:"p-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-red-700",children:[(0,r.jsx)(p.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"font-medium",children:"No Compatible Payment Methods"})]}),(0,r.jsxs)("p",{className:"text-red-600 text-sm mt-1",children:[z.fullName," ","doesn't have any verified accounts that can receive"," ",s.receiveCurrency,"."]})]})}):(0,r.jsxs)(l.Zp,{children:[(0,r.jsxs)(l.aR,{children:[(0,r.jsx)(l.ZB,{className:"text-sm",children:"Select Payment Method"}),(0,r.jsxs)("p",{className:"text-xs text-gray-600",children:["Choose how ",z.fullName," should receive the ",s.receiveCurrency]})]}),(0,r.jsx)(l.Wu,{className:"space-y-2",children:e.map(e=>(0,r.jsx)("div",{className:"p-3 border rounded-lg cursor-pointer transition-all ".concat((null==Y?void 0:Y.id)===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>X(e),children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(y.A,{className:"w-4 h-4 text-gray-500"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:"text-sm font-medium",children:e.bankName||"".concat(e.type.replace("_"," "))}),e.isDefault&&(0,r.jsx)(m.E,{variant:"secondary",className:"text-xs",children:"Default"})]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[e.accountType," • ",e.currency," • ",e.country,e.lastFourDigits&&" • ****".concat(e.lastFourDigits)]}),(0,r.jsxs)("div",{className:"text-xs text-gray-400",children:["Verified ",new Date(e.verifiedAt).toLocaleDateString()]})]}),(null==Y?void 0:Y.id)===e.id&&(0,r.jsx)(o.A,{className:"w-4 h-4 text-blue-500"})]})},e.id))})]})})()]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsxs)(n.$,{variant:"outline",onClick:w,disabled:A,children:[(0,r.jsx)(v.A,{className:"mr-2 h-4 w-4"}),"Back"]}),(0,r.jsx)(n.$,{onClick:()=>{z&&Y&&a(z,Y)},disabled:!z||!Y||A,children:A?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):(0,r.jsxs)(r.Fragment,{children:["Continue to Payment",(0,r.jsx)(b.A,{className:"ml-2 h-4 w-4"})]})})]})]})}}}]);