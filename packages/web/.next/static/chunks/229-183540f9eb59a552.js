"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[229],{2055:(e,s,a)=>{a.d(s,{A:()=>t});let t=(0,a(8889).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},3185:(e,s,a)=>{a.d(s,{A:()=>t});let t=(0,a(8889).A)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]])},8229:(e,s,a)=>{a.d(s,{E:()=>b});var t=a(4568),r=a(7620),c=a(7227),l=a(3353),n=a(5165),i=a(2555),d=a(4148),x=a(9594),m=a(5191),h=a(3185),o=a(5774),u=a(9513),j=a(9690),p=a(5945),y=a(2055);let N=(0,a(8889).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);var f=a(9369),g=a(8276),v=a(7277);function b(e){let{transferData:s,onRecipientSelected:a,onBack:b,currentUserId:w,isLoading:k=!1}=e,[C,A]=(0,r.useState)(""),[S,F]=(0,r.useState)([]),[E,R]=(0,r.useState)(!1),[Z,_]=(0,r.useState)(null),[P,D]=(0,r.useState)(!1),[M,T]=(0,r.useState)([]),[W,L]=(0,r.useState)(!1),[U,B]=(0,r.useState)(null),[I,z]=(0,r.useState)(null),[$,q]=(0,r.useState)(null),[V,Y]=(0,r.useState)("recent");(0,r.useEffect)(()=>{w&&H()},[w]),(0,r.useEffect)(()=>{if(C.trim().length>=2){let e=setTimeout(()=>{J(C.trim())},500);return()=>clearTimeout(e)}F([]),D(!1),_(null)},[C]);let H=(0,r.useCallback)(async()=>{if(w){L(!0),B(null);try{let e=await fetch("".concat("http://localhost:4000","/api/users/me/recipients"),{headers:{Authorization:"Bearer ".concat(await G()),"Content-Type":"application/json"}});if(!e.ok)throw Error("Failed to load recent recipients");let s=await e.json();T(s.recipients||[])}catch(e){console.error("Error loading recent recipients:",e),B("Failed to load recent recipients"),T([])}finally{L(!1)}}},[w]),J=(0,r.useCallback)(async e=>{R(!0),_(null);try{let a=new URLSearchParams({q:e,currency:s.receiveCurrency,limit:"10"}),t=await fetch("".concat("http://localhost:4000","/api/users/search?").concat(a),{headers:{Authorization:"Bearer ".concat(await G()),"Content-Type":"application/json"}});if(!t.ok)throw Error("Failed to search users");let r=(await t.json()).users.filter(e=>e.id!==w);F(r),D(!0)}catch(e){console.error("Error searching users:",e),_("Failed to search users. Please try again."),F([])}finally{R(!1)}},[s.receiveCurrency,w]),G=async()=>{try{return sessionStorage.getItem("__clerk_token")||localStorage.getItem("__clerk_token")||"mock-token"}catch(e){return console.warn("Failed to get auth token:",e),"mock-token"}},K=e=>{z(e);let a=e.verifiedPaymentMethods.filter(e=>e.currency===s.receiveCurrency),t=a.find(e=>e.isDefault)||a[0];t&&q(t)},O=e=>{q(e)},Q=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,c=e.verifiedPaymentMethods.filter(e=>e.currency===s.receiveCurrency),n=(null==I?void 0:I.id)===e.id;return(0,t.jsx)(l.Zp,{className:"cursor-pointer transition-all hover:shadow-md ".concat(n?"ring-2 ring-blue-500 bg-blue-50":""),onClick:()=>K(e),children:(0,t.jsx)(l.Wu,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:e.profileImageUrl?(0,t.jsx)("img",{src:e.profileImageUrl,alt:e.fullName,className:"w-12 h-12 rounded-full object-cover"}):(0,t.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center",children:(0,t.jsx)(x.A,{className:"w-6 h-6 text-gray-500"})})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:e.fullName}),e.isVerified&&(0,t.jsx)(m.A,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),a&&(null==r?void 0:r.isFavorite)&&(0,t.jsx)(h.A,{className:"w-4 h-4 text-yellow-500 flex-shrink-0"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500 mb-2",children:[e.email&&(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)(o.A,{className:"w-3 h-3"}),(0,t.jsx)("span",{className:"truncate",children:e.email})]}),e.username&&(0,t.jsx)("div",{className:"flex items-center space-x-1",children:(0,t.jsxs)("span",{children:["@",e.username]})})]}),a&&r&&(0,t.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500 mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)(u.A,{className:"w-3 h-3"}),(0,t.jsxs)("span",{children:["Last: ",new Date(r.lastTransferAt).toLocaleDateString()]})]}),(0,t.jsxs)("div",{children:[r.transferCount," transfer",1!==r.transferCount?"s":""]})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1 mb-2",children:e.supportedCurrencies.map(e=>(0,t.jsx)(d.E,{variant:e===s.receiveCurrency?"default":"secondary",className:"text-xs",children:e},e))}),c.length>0?(0,t.jsxs)("div",{className:"text-xs text-green-600",children:["✓ ",c.length," verified account",1!==c.length?"s":""," for ",s.receiveCurrency]}):(0,t.jsxs)("div",{className:"text-xs text-red-600",children:["✗ No verified accounts for ",s.receiveCurrency]})]})]})})},e.id)};return(0,t.jsxs)("div",{className:"w-full max-w-4xl mx-auto space-y-6",children:[(0,t.jsx)(l.Zp,{children:(0,t.jsxs)(l.aR,{children:[(0,t.jsxs)(l.ZB,{className:"flex items-center space-x-2",children:[(0,t.jsx)(y.A,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Send to User"})]}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["Send ",s.sendAmount," ",s.sendCurrency," to a registered user"]})]})}),(0,t.jsx)(l.Zp,{className:"bg-gray-50",children:(0,t.jsxs)(l.Wu,{className:"p-4",children:[(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"Transfer Summary"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"You Send:"}),(0,t.jsxs)("span",{className:"font-medium",children:[s.sendAmount," ",s.sendCurrency]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"They Receive:"}),(0,t.jsxs)("span",{className:"font-medium",children:[s.receiveAmount," ",s.receiveCurrency]})]}),(0,t.jsxs)("div",{className:"flex justify-between col-span-2",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Exchange Rate:"}),(0,t.jsxs)("span",{className:"font-medium",children:["1 ",s.sendCurrency," = ",s.exchangeRate.toFixed(4)," ",s.receiveCurrency]})]})]})]})}),(0,t.jsxs)("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[(0,t.jsxs)("button",{className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat("recent"===V?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),onClick:()=>Y("recent"),children:[(0,t.jsx)(u.A,{className:"w-4 h-4 inline mr-2"}),"Recent Recipients"]}),(0,t.jsxs)("button",{className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat("search"===V?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),onClick:()=>Y("search"),children:[(0,t.jsx)(N,{className:"w-4 h-4 inline mr-2"}),"Search Users"]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:["search"===V&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.J,{htmlFor:"user-search",children:"Search by email, username, or phone"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,t.jsx)(n.p,{id:"user-search",placeholder:"Enter email, username, or phone number...",className:"pl-10",value:C,onChange:e=>A(e.target.value)}),E&&(0,t.jsx)(f.A,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 animate-spin text-gray-400"})]})]}),Z&&(0,t.jsx)(l.Zp,{className:"border-red-200 bg-red-50",children:(0,t.jsx)(l.Wu,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2 text-red-700",children:[(0,t.jsx)(j.A,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:Z})]})})}),P&&!E&&0===S.length&&!Z&&(0,t.jsx)(l.Zp,{children:(0,t.jsxs)(l.Wu,{className:"p-8 text-center",children:[(0,t.jsx)(y.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No users found"}),(0,t.jsxs)("p",{className:"text-gray-600",children:['No users found matching "',C,'". Try a different search term.']})]})}),S.length>0&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("h3",{className:"text-sm font-medium text-gray-700",children:["Search Results (",S.length,")"]}),S.map(e=>Q(e))]})]}),"recent"===V&&(0,t.jsxs)(t.Fragment,{children:[U&&(0,t.jsx)(l.Zp,{className:"border-red-200 bg-red-50",children:(0,t.jsx)(l.Wu,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2 text-red-700",children:[(0,t.jsx)(j.A,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:U})]})})}),W?(0,t.jsx)(l.Zp,{children:(0,t.jsxs)(l.Wu,{className:"p-8 text-center",children:[(0,t.jsx)(f.A,{className:"w-8 h-8 animate-spin text-gray-400 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Loading recent recipients..."})]})}):0===M.length?(0,t.jsx)(l.Zp,{children:(0,t.jsxs)(l.Wu,{className:"p-8 text-center",children:[(0,t.jsx)(u.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No recent recipients"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"You haven't sent money to any users yet. Use the search tab to find someone to send money to."}),(0,t.jsxs)(c.$,{variant:"outline",onClick:()=>Y("search"),children:[(0,t.jsx)(N,{className:"w-4 h-4 mr-2"}),"Search Users"]})]})}):(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("h3",{className:"text-sm font-medium text-gray-700",children:["Recent Recipients (",M.length,")"]}),M.map(e=>Q(e.userProfile,!0,e))]})]})]}),I&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Selected Recipient"}),Q(I),(()=>{if(!I)return null;let e=I.verifiedPaymentMethods.filter(e=>e.currency===s.receiveCurrency);return 0===e.length?(0,t.jsx)(l.Zp,{className:"border-red-200 bg-red-50",children:(0,t.jsxs)(l.Wu,{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 text-red-700",children:[(0,t.jsx)(j.A,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"font-medium",children:"No Compatible Payment Methods"})]}),(0,t.jsxs)("p",{className:"text-red-600 text-sm mt-1",children:[I.fullName," doesn't have any verified accounts that can receive ",s.receiveCurrency,"."]})]})}):(0,t.jsxs)(l.Zp,{children:[(0,t.jsxs)(l.aR,{children:[(0,t.jsx)(l.ZB,{className:"text-sm",children:"Select Payment Method"}),(0,t.jsxs)("p",{className:"text-xs text-gray-600",children:["Choose how ",I.fullName," should receive the ",s.receiveCurrency]})]}),(0,t.jsx)(l.Wu,{className:"space-y-2",children:e.map(e=>(0,t.jsx)("div",{className:"p-3 border rounded-lg cursor-pointer transition-all ".concat((null==$?void 0:$.id)===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>O(e),children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(p.A,{className:"w-4 h-4 text-gray-500"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:e.bankName||"".concat(e.type.replace("_"," "))}),e.isDefault&&(0,t.jsx)(d.E,{variant:"secondary",className:"text-xs",children:"Default"})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:[e.accountType," • ",e.currency," • ",e.country,e.lastFourDigits&&" • ****".concat(e.lastFourDigits)]}),(0,t.jsxs)("div",{className:"text-xs text-gray-400",children:["Verified ",new Date(e.verifiedAt).toLocaleDateString()]})]}),(null==$?void 0:$.id)===e.id&&(0,t.jsx)(m.A,{className:"w-4 h-4 text-blue-500"})]})},e.id))})]})})()]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)(c.$,{variant:"outline",onClick:b,disabled:k,children:[(0,t.jsx)(g.A,{className:"mr-2 h-4 w-4"}),"Back"]}),(0,t.jsx)(c.$,{onClick:()=>{I&&$&&a(I,$)},disabled:!I||!$||k,children:k?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):(0,t.jsxs)(t.Fragment,{children:["Continue to Payment",(0,t.jsx)(v.A,{className:"ml-2 h-4 w-4"})]})})]})]})}}}]);