"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[466],{7466:(e,s,a)=>{a.d(s,{d:()=>D,n:()=>w});var r=a(4568),t=a(7620),c=a(7717),n=a(818),l=a(1773),i=a(8276),d=a(9594),m=a(5191),x=a(5774),o=a(8521),h=a(5945),u=a(9690),p=a(9369),j=a(3872),g=a(7227),N=a(3353),v=a(5165),y=a(2555),f=a(4148);let b=c.Ik({number:c.Yj().min(13,"Card number must be at least 13 digits").max(19,"Card number cannot exceed 19 digits"),expiryMonth:c.ai().min(1,"Invalid month").max(12,"Invalid month"),expiryYear:c.ai().min(new Date().getFullYear(),"Card has expired").max(new Date().getFullYear()+20,"Invalid year"),cvv:c.Yj().min(3,"CVV must be at least 3 digits").max(4,"CVV cannot exceed 4 digits")}),A=c.Ik({cardDetails:b});function w(e){let{sendAmount:s,receiveAmount:a,exchangeRate:w,fees:D,rateId:C,onSubmit:k,isLoading:F=!1,transferData:I,recipientUser:Y,selectedPaymentMethod:S,onSuccess:M,onBack:B,onError:E}=e,T=!!(I&&Y&&S),J=I||{sendAmount:s,receiveAmount:a,sendCurrency:"USD",receiveCurrency:"EUR",exchangeRate:w,fees:D,rateId:C,rateValidUntil:"",calculatorMode:"send",breakdown:{sendAmountUSD:s,fees:{cardProcessing:0,transfer:0,payout:0,total:D},netAmountUSD:s-D,exchangeRate:w,receiveAmount:a},estimatedArrival:""},[P,R]=(0,t.useState)({number:"",expiryMonth:1,expiryYear:new Date().getFullYear(),cvv:""}),[U,V]=(0,t.useState)({name:"",email:"",bankAccount:{iban:"",bic:"",bankName:"",accountHolderName:"",country:"DE"}}),[Z,L]=(0,t.useState)({}),[W,$]=(0,t.useState)(!1),_=e=>{let s=e.replace(/\s/g,"").replace(/[^0-9]/gi,""),a=s.match(/\d{4,16}/g),r=a&&a[0]||"",t=[];for(let e=0,s=r.length;e<s;e+=4)t.push(r.substring(e,e+4));return t.length?t.join(" "):s},H=(e,s)=>{R(a=>({...a,[e]:s})),Z["cardDetails.".concat(e)]&&L(s=>{let a={...s};return delete a["cardDetails.".concat(e)],a})},O=(e,s)=>{if(e.startsWith("bankAccount.")){let a=e.replace("bankAccount.","");V(e=>({...e,bankAccount:{...e.bankAccount,[a]:s}}))}else V(a=>({...a,[e]:s}));Z["recipientInfo.".concat(e)]&&L(s=>{let a={...s};return delete a["recipientInfo.".concat(e)],a})},z=async()=>"mock-token",G="CLP"===J.sendCurrency&&"CLP"===J.receiveCurrency,X=async e=>{e.preventDefault(),L({}),$(!0);try{if(T){let e={cardDetails:{...P,number:P.number.replace(/\s/g,"")}};A.parse(e);let s="http://localhost:4000",a=G?{sendAmount:J.sendAmount,sendCurrency:J.sendCurrency,receiveCurrency:J.receiveCurrency,rateId:J.rateId,cardDetails:e.cardDetails,recipientUserId:Y.id,recipientPaymentMethodId:S.id,transferType:"chilean_user_to_user"}:{sendAmount:J.sendAmount,sendCurrency:J.sendCurrency,receiveCurrency:J.receiveCurrency,rateId:J.rateId,cardDetails:e.cardDetails,recipientUserId:Y.id,recipientPaymentMethodId:S.id},r=await fetch(G?"".concat(s,"/api/transfers/create-chilean-user-transfer"):"".concat(s,"/api/transfers/create-user-to-user"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(await z())},body:JSON.stringify(a)});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.message||"Failed to create transfer")}let t=await r.json();M&&M(t.transferId)}else{let e={cardDetails:{...P,number:P.number.replace(/\s/g,"")},recipientInfo:{...U,bankAccount:{...U.bankAccount,iban:U.bankAccount.iban.replace(/\s/g,"")}}};c.Ik({cardDetails:b,recipientInfo:c.Ik({name:c.Yj().min(2,"Name must be at least 2 characters").max(100,"Name cannot exceed 100 characters"),email:c.Yj().email("Invalid email address"),bankAccount:c.Ik({iban:c.Yj().min(15,"IBAN must be at least 15 characters").max(34,"IBAN cannot exceed 34 characters"),bic:c.Yj().min(8,"BIC must be at least 8 characters").max(11,"BIC cannot exceed 11 characters"),bankName:c.Yj().min(2,"Bank name must be at least 2 characters").max(100,"Bank name cannot exceed 100 characters"),accountHolderName:c.Yj().min(2,"Account holder name must be at least 2 characters").max(100,"Account holder name cannot exceed 100 characters"),country:c.eu("DE").refine(()=>!0,{message:"Only German bank accounts are supported"})})})}).parse(e),k(e)}}catch(e){if(console.error("Transfer creation error:",e),e instanceof n.G){let s={};e.issues.forEach(e=>{s[e.path.join(".")]=e.message}),L(s)}else{let s=e instanceof Error?e.message:"Failed to create transfer";E&&E(s)}}finally{$(!1)}},q=J.sendAmount+J.fees;return T?(0,r.jsxs)("div",{className:"w-full max-w-4xl mx-auto space-y-6",children:[B&&(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)(g.$,{variant:"outline",onClick:B,disabled:F||W,className:"flex items-center gap-2",children:[(0,r.jsx)(i.A,{className:"h-4 w-4"}),"Back"]}),(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Complete Payment"}),(0,r.jsx)("div",{})," "]}),(0,r.jsxs)(N.Zp,{children:[(0,r.jsx)(N.aR,{children:(0,r.jsxs)(N.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(d.A,{className:"h-5 w-5"}),"Transfer Summary"]})}),(0,r.jsxs)(N.Wu,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"font-semibold text-sm text-gray-600 uppercase tracking-wide",children:"From"}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:(0,r.jsx)(d.A,{className:"w-5 h-5 text-blue-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:"You"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Sending via card payment"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"font-semibold text-sm text-gray-600 uppercase tracking-wide",children:"To"}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[Y.profileImageUrl?(0,r.jsx)(l.default,{src:Y.profileImageUrl,alt:Y.fullName,width:40,height:40,className:"w-10 h-10 rounded-full object-cover"}):(0,r.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center",children:(0,r.jsx)(d.A,{className:"w-5 h-5 text-gray-500"})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("p",{className:"font-medium",children:Y.fullName}),Y.isVerified&&(0,r.jsx)(m.A,{className:"w-4 h-4 text-green-500"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-gray-600",children:[(0,r.jsx)(x.A,{className:"w-3 h-3"}),(0,r.jsx)("span",{children:Y.email})]})]})]})]})]}),(0,r.jsx)("div",{className:"border-t pt-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"font-semibold text-sm text-gray-600 uppercase tracking-wide",children:"You Send"}),(0,r.jsxs)("div",{className:"text-2xl font-bold text-gray-900",children:[J.sendAmount.toFixed(2)," ",J.sendCurrency]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["+ ",J.fees.toFixed(2)," ",J.sendCurrency," fees"]}),(0,r.jsxs)("div",{className:"text-lg font-semibold border-t pt-2",children:["Total: ",q.toFixed(2)," ",J.sendCurrency]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"font-semibold text-sm text-gray-600 uppercase tracking-wide",children:"They Receive"}),(0,r.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:[J.receiveAmount.toFixed(2)," ",J.receiveCurrency]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["Exchange rate: 1 ",J.sendCurrency," = ",J.exchangeRate.toFixed(4)," ",J.receiveCurrency]}),J.estimatedArrival&&(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["Estimated arrival: ",J.estimatedArrival]})]})]})})]})]}),(0,r.jsxs)(N.Zp,{children:[(0,r.jsxs)(N.aR,{children:[(0,r.jsxs)(N.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(o.A,{className:"h-5 w-5"}),"Recipient's Bank Account"]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[Y.fullName," will receive the money in their verified account"]})]}),(0,r.jsx)(N.Wu,{children:(0,r.jsxs)("div",{className:"flex items-center space-x-3 p-4 bg-gray-50 rounded-lg",children:[(0,r.jsx)(h.A,{className:"w-5 h-5 text-gray-500"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:"font-medium",children:S.bankName||"".concat(S.type.replace("_"," "))}),(0,r.jsx)(f.E,{variant:"secondary",className:"text-xs",children:S.currency}),S.isDefault&&(0,r.jsx)(f.E,{variant:"outline",className:"text-xs",children:"Default"})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[S.accountType," • ",S.country,S.lastFourDigits&&(0,r.jsxs)("span",{children:[" • ****",S.lastFourDigits]})]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["Verified ",new Date(S.verifiedAt).toLocaleDateString()]})]}),(0,r.jsx)(m.A,{className:"w-5 h-5 text-green-500"})]})})]}),(0,r.jsxs)(N.Zp,{children:[(0,r.jsxs)(N.aR,{children:[(0,r.jsxs)(N.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(h.A,{className:"h-5 w-5"}),"Your Payment Method"]}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Enter your card details to complete the transfer"})]}),(0,r.jsx)(N.Wu,{children:(0,r.jsxs)("form",{onSubmit:X,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(y.J,{htmlFor:"card-number",children:"Card Number"}),(0,r.jsx)(v.p,{id:"card-number",type:"text",placeholder:"1234 5678 9012 3456",value:_(P.number),onChange:e=>H("number",e.target.value.replace(/\s/g,"")),className:Z["cardDetails.number"]?"border-red-500":"",maxLength:19}),Z["cardDetails.number"]&&(0,r.jsxs)("p",{className:"text-sm text-red-500 mt-1 flex items-center gap-1",children:[(0,r.jsx)(u.A,{className:"h-3 w-3"}),Z["cardDetails.number"]]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(y.J,{htmlFor:"expiry-month",children:"Month"}),(0,r.jsx)(v.p,{id:"expiry-month",type:"number",placeholder:"MM",min:"1",max:"12",value:P.expiryMonth,onChange:e=>H("expiryMonth",parseInt(e.target.value)||1),className:Z["cardDetails.expiryMonth"]?"border-red-500":""}),Z["cardDetails.expiryMonth"]&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:Z["cardDetails.expiryMonth"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(y.J,{htmlFor:"expiry-year",children:"Year"}),(0,r.jsx)(v.p,{id:"expiry-year",type:"number",placeholder:"YYYY",min:new Date().getFullYear(),max:new Date().getFullYear()+20,value:P.expiryYear,onChange:e=>H("expiryYear",parseInt(e.target.value)||new Date().getFullYear()),className:Z["cardDetails.expiryYear"]?"border-red-500":""}),Z["cardDetails.expiryYear"]&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:Z["cardDetails.expiryYear"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(y.J,{htmlFor:"cvv",children:"CVV"}),(0,r.jsx)(v.p,{id:"cvv",type:"text",placeholder:"123",maxLength:4,value:P.cvv,onChange:e=>H("cvv",e.target.value.replace(/[^0-9]/g,"")),className:Z["cardDetails.cvv"]?"border-red-500":""}),Z["cardDetails.cvv"]&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:Z["cardDetails.cvv"]})]})]})]}),(0,r.jsx)(g.$,{type:"submit",disabled:F||W,className:"w-full",size:"lg",children:F||W?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing Transfer..."]}):"Send ".concat(q.toFixed(2)," ").concat(J.sendCurrency," to ").concat(Y.fullName)}),(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-xs text-muted-foreground",children:[(0,r.jsx)(j.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"Secured by Circle • PCI DSS Compliant"})]})]})})]})]}):(0,r.jsxs)(N.Zp,{className:"w-full max-w-2xl mx-auto",children:[(0,r.jsxs)(N.aR,{children:[(0,r.jsxs)(N.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(h.A,{className:"h-5 w-5"}),"Complete Your Transfer"]}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"You send:"}),(0,r.jsxs)("span",{className:"font-medium",children:["$",J.sendAmount.toFixed(2)," ",J.sendCurrency]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Fees:"}),(0,r.jsxs)("span",{className:"font-medium",children:["$",J.fees.toFixed(2)," ",J.sendCurrency]})]}),(0,r.jsxs)("div",{className:"flex justify-between border-t pt-1 mt-1",children:[(0,r.jsx)("span",{children:"Total to pay:"}),(0,r.jsxs)("span",{className:"font-bold",children:["$",q.toFixed(2)," ",J.sendCurrency]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-green-600",children:[(0,r.jsx)("span",{children:"Recipient gets:"}),(0,r.jsxs)("span",{className:"font-bold",children:["€",J.receiveAmount.toFixed(2)," ",J.receiveCurrency]})]})]})]}),(0,r.jsx)(N.Wu,{children:(0,r.jsxs)("form",{onSubmit:X,className:"space-y-8",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,r.jsx)(h.A,{className:"h-4 w-4"}),(0,r.jsx)("h3",{className:"font-semibold",children:"Payment Details"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(y.J,{htmlFor:"card-number",children:"Card Number"}),(0,r.jsx)(v.p,{id:"card-number",type:"text",placeholder:"1234 5678 9012 3456",value:_(P.number),onChange:e=>H("number",e.target.value.replace(/\s/g,"")),className:Z["cardDetails.number"]?"border-red-500":"",maxLength:19}),Z["cardDetails.number"]&&(0,r.jsxs)("p",{className:"text-sm text-red-500 mt-1 flex items-center gap-1",children:[(0,r.jsx)(u.A,{className:"h-3 w-3"}),Z["cardDetails.number"]]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(y.J,{htmlFor:"expiry-month",children:"Month"}),(0,r.jsx)(v.p,{id:"expiry-month",type:"number",placeholder:"MM",min:"1",max:"12",value:P.expiryMonth,onChange:e=>H("expiryMonth",parseInt(e.target.value)||1),className:Z["cardDetails.expiryMonth"]?"border-red-500":""}),Z["cardDetails.expiryMonth"]&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:Z["cardDetails.expiryMonth"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(y.J,{htmlFor:"expiry-year",children:"Year"}),(0,r.jsx)(v.p,{id:"expiry-year",type:"number",placeholder:"YYYY",min:new Date().getFullYear(),max:new Date().getFullYear()+20,value:P.expiryYear,onChange:e=>H("expiryYear",parseInt(e.target.value)||new Date().getFullYear()),className:Z["cardDetails.expiryYear"]?"border-red-500":""}),Z["cardDetails.expiryYear"]&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:Z["cardDetails.expiryYear"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(y.J,{htmlFor:"cvv",children:"CVV"}),(0,r.jsx)(v.p,{id:"cvv",type:"text",placeholder:"123",maxLength:4,value:P.cvv,onChange:e=>H("cvv",e.target.value.replace(/[^0-9]/g,"")),className:Z["cardDetails.cvv"]?"border-red-500":""}),Z["cardDetails.cvv"]&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:Z["cardDetails.cvv"]})]})]})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,r.jsx)(d.A,{className:"h-4 w-4"}),(0,r.jsx)("h3",{className:"font-semibold",children:"Recipient Information"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(y.J,{htmlFor:"recipient-name",children:"Full Name"}),(0,r.jsx)(v.p,{id:"recipient-name",type:"text",placeholder:"John Doe",value:U.name,onChange:e=>O("name",e.target.value),className:Z["recipientInfo.name"]?"border-red-500":""}),Z["recipientInfo.name"]&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:Z["recipientInfo.name"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(y.J,{htmlFor:"recipient-email",children:"Email Address"}),(0,r.jsx)(v.p,{id:"recipient-email",type:"email",placeholder:"john@example.com",value:U.email,onChange:e=>O("email",e.target.value),className:Z["recipientInfo.email"]?"border-red-500":""}),Z["recipientInfo.email"]&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:Z["recipientInfo.email"]})]})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,r.jsx)(o.A,{className:"h-4 w-4"}),(0,r.jsx)("h3",{className:"font-semibold",children:"Bank Account Details (Germany)"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(y.J,{htmlFor:"iban",children:"IBAN"}),(0,r.jsx)(v.p,{id:"iban",type:"text",placeholder:"DE89 3704 0044 0532 0130 00",value:U.bankAccount.iban.replace(/\s/g,"").toUpperCase().replace(/(.{4})/g,"$1 ").trim(),onChange:e=>O("bankAccount.iban",e.target.value.replace(/\s/g,"")),className:Z["recipientInfo.bankAccount.iban"]?"border-red-500":""}),Z["recipientInfo.bankAccount.iban"]&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:Z["recipientInfo.bankAccount.iban"]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(y.J,{htmlFor:"bic",children:"BIC/SWIFT Code"}),(0,r.jsx)(v.p,{id:"bic",type:"text",placeholder:"COBADEFFXXX",value:U.bankAccount.bic,onChange:e=>O("bankAccount.bic",e.target.value.toUpperCase()),className:Z["recipientInfo.bankAccount.bic"]?"border-red-500":""}),Z["recipientInfo.bankAccount.bic"]&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:Z["recipientInfo.bankAccount.bic"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(y.J,{htmlFor:"bank-name",children:"Bank Name"}),(0,r.jsx)(v.p,{id:"bank-name",type:"text",placeholder:"Deutsche Bank",value:U.bankAccount.bankName,onChange:e=>O("bankAccount.bankName",e.target.value),className:Z["recipientInfo.bankAccount.bankName"]?"border-red-500":""}),Z["recipientInfo.bankAccount.bankName"]&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:Z["recipientInfo.bankAccount.bankName"]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(y.J,{htmlFor:"account-holder",children:"Account Holder Name"}),(0,r.jsx)(v.p,{id:"account-holder",type:"text",placeholder:"John Doe",value:U.bankAccount.accountHolderName,onChange:e=>O("bankAccount.accountHolderName",e.target.value),className:Z["recipientInfo.bankAccount.accountHolderName"]?"border-red-500":""}),Z["recipientInfo.bankAccount.accountHolderName"]&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:Z["recipientInfo.bankAccount.accountHolderName"]})]})]})]}),(0,r.jsx)(g.$,{type:"submit",disabled:F||W,className:"w-full",size:"lg",children:F||W?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing Transfer..."]}):"Send ".concat(J.sendAmount.toFixed(2)," USD")}),(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-xs text-muted-foreground",children:[(0,r.jsx)(j.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"Secured by Circle • PCI DSS Compliant"})]})]})})]})}function D(e){let{transferData:s,recipientUser:a,selectedPaymentMethod:c,onSuccess:b,onBack:w,onError:D,isLoading:C=!1}=e,[k,F]=(0,t.useState)({number:"",expiryMonth:1,expiryYear:new Date().getFullYear(),cvv:""}),[I,Y]=(0,t.useState)({}),[S,M]=(0,t.useState)(!1),B=(e,s)=>{F(a=>({...a,[e]:s})),I["cardDetails.".concat(e)]&&Y(s=>{let a={...s};return delete a["cardDetails.".concat(e)],a})},E=async e=>{e.preventDefault(),Y({}),M(!0);try{let e={cardDetails:{...k,number:k.number.replace(/\s/g,"")}};A.parse(e);let r=await fetch("".concat("http://localhost:4000","/api/transfers/create-user-to-user"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(await T())},body:JSON.stringify({sendAmount:s.sendAmount,sendCurrency:s.sendCurrency,receiveCurrency:s.receiveCurrency,rateId:s.rateId,cardDetails:e.cardDetails,recipientUserId:a.id,recipientPaymentMethodId:c.id})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.message||"Failed to create transfer")}let t=await r.json();b(t.transferId)}catch(e){if(console.error("Transfer creation error:",e),e instanceof n.G){let s={};e.issues.forEach(e=>{s[e.path.join(".")]=e.message}),Y(s)}else D(e instanceof Error?e.message:"Failed to create transfer")}finally{M(!1)}},T=async()=>"mock-token",J=s.sendAmount+s.fees;return(0,r.jsxs)("div",{className:"w-full max-w-4xl mx-auto space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)(g.$,{variant:"outline",onClick:w,disabled:C||S,className:"flex items-center gap-2",children:[(0,r.jsx)(i.A,{className:"h-4 w-4"}),"Back"]}),(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Complete Payment"}),(0,r.jsx)("div",{})," "]}),(0,r.jsxs)(N.Zp,{children:[(0,r.jsx)(N.aR,{children:(0,r.jsxs)(N.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(d.A,{className:"h-5 w-5"}),"Transfer Summary"]})}),(0,r.jsxs)(N.Wu,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"font-semibold text-sm text-gray-600 uppercase tracking-wide",children:"From"}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:(0,r.jsx)(d.A,{className:"w-5 h-5 text-blue-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:"You"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Sending via card payment"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"font-semibold text-sm text-gray-600 uppercase tracking-wide",children:"To"}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[a.profileImageUrl?(0,r.jsx)(l.default,{src:a.profileImageUrl,alt:a.fullName,width:40,height:40,className:"w-10 h-10 rounded-full object-cover"}):(0,r.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center",children:(0,r.jsx)(d.A,{className:"w-5 h-5 text-gray-500"})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("p",{className:"font-medium",children:a.fullName}),a.isVerified&&(0,r.jsx)(m.A,{className:"w-4 h-4 text-green-500"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-gray-600",children:[(0,r.jsx)(x.A,{className:"w-3 h-3"}),(0,r.jsx)("span",{children:a.email})]})]})]})]})]}),(0,r.jsx)("div",{className:"border-t pt-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"font-semibold text-sm text-gray-600 uppercase tracking-wide",children:"You Send"}),(0,r.jsxs)("div",{className:"text-2xl font-bold text-gray-900",children:[s.sendAmount.toFixed(2)," ",s.sendCurrency]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["+ ",s.fees.toFixed(2)," ",s.sendCurrency," fees"]}),(0,r.jsxs)("div",{className:"text-lg font-semibold border-t pt-2",children:["Total: ",J.toFixed(2)," ",s.sendCurrency]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"font-semibold text-sm text-gray-600 uppercase tracking-wide",children:"They Receive"}),(0,r.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:[s.receiveAmount.toFixed(2)," ",s.receiveCurrency]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["Exchange rate: 1 ",s.sendCurrency," = ",s.exchangeRate.toFixed(4)," ",s.receiveCurrency]}),s.estimatedArrival&&(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["Estimated arrival: ",s.estimatedArrival]})]})]})})]})]}),(0,r.jsxs)(N.Zp,{children:[(0,r.jsxs)(N.aR,{children:[(0,r.jsxs)(N.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(o.A,{className:"h-5 w-5"}),"Recipient's Bank Account"]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[a.fullName," will receive the money in their verified account"]})]}),(0,r.jsx)(N.Wu,{children:(0,r.jsxs)("div",{className:"flex items-center space-x-3 p-4 bg-gray-50 rounded-lg",children:[(0,r.jsx)(h.A,{className:"w-5 h-5 text-gray-500"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:"font-medium",children:c.bankName||"".concat(c.type.replace("_"," "))}),(0,r.jsx)(f.E,{variant:"secondary",className:"text-xs",children:c.currency}),c.isDefault&&(0,r.jsx)(f.E,{variant:"outline",className:"text-xs",children:"Default"})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[c.accountType," • ",c.country,c.lastFourDigits&&(0,r.jsxs)("span",{children:[" • ****",c.lastFourDigits]})]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["Verified ",new Date(c.verifiedAt).toLocaleDateString()]})]}),(0,r.jsx)(m.A,{className:"w-5 h-5 text-green-500"})]})})]}),(0,r.jsxs)(N.Zp,{children:[(0,r.jsxs)(N.aR,{children:[(0,r.jsxs)(N.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(h.A,{className:"h-5 w-5"}),"Your Payment Method"]}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Enter your card details to complete the transfer"})]}),(0,r.jsx)(N.Wu,{children:(0,r.jsxs)("form",{onSubmit:E,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(y.J,{htmlFor:"card-number",children:"Card Number"}),(0,r.jsx)(v.p,{id:"card-number",type:"text",placeholder:"1234 5678 9012 3456",value:(e=>{let s=e.replace(/\s/g,"").replace(/[^0-9]/gi,""),a=s.match(/\d{4,16}/g),r=a&&a[0]||"",t=[];for(let e=0,s=r.length;e<s;e+=4)t.push(r.substring(e,e+4));return t.length?t.join(" "):s})(k.number),onChange:e=>B("number",e.target.value.replace(/\s/g,"")),className:I["cardDetails.number"]?"border-red-500":"",maxLength:19}),I["cardDetails.number"]&&(0,r.jsxs)("p",{className:"text-sm text-red-500 mt-1 flex items-center gap-1",children:[(0,r.jsx)(u.A,{className:"h-3 w-3"}),I["cardDetails.number"]]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(y.J,{htmlFor:"expiry-month",children:"Month"}),(0,r.jsx)(v.p,{id:"expiry-month",type:"number",placeholder:"MM",min:"1",max:"12",value:k.expiryMonth,onChange:e=>B("expiryMonth",parseInt(e.target.value)||1),className:I["cardDetails.expiryMonth"]?"border-red-500":""}),I["cardDetails.expiryMonth"]&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:I["cardDetails.expiryMonth"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(y.J,{htmlFor:"expiry-year",children:"Year"}),(0,r.jsx)(v.p,{id:"expiry-year",type:"number",placeholder:"YYYY",min:new Date().getFullYear(),max:new Date().getFullYear()+20,value:k.expiryYear,onChange:e=>B("expiryYear",parseInt(e.target.value)||new Date().getFullYear()),className:I["cardDetails.expiryYear"]?"border-red-500":""}),I["cardDetails.expiryYear"]&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:I["cardDetails.expiryYear"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(y.J,{htmlFor:"cvv",children:"CVV"}),(0,r.jsx)(v.p,{id:"cvv",type:"text",placeholder:"123",maxLength:4,value:k.cvv,onChange:e=>B("cvv",e.target.value.replace(/[^0-9]/g,"")),className:I["cardDetails.cvv"]?"border-red-500":""}),I["cardDetails.cvv"]&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:I["cardDetails.cvv"]})]})]})]}),(0,r.jsx)(g.$,{type:"submit",disabled:C||S,className:"w-full",size:"lg",children:C||S?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing Transfer..."]}):"Send ".concat(J.toFixed(2)," ").concat(s.sendCurrency," to ").concat(a.fullName)}),(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-xs text-muted-foreground",children:[(0,r.jsx)(j.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"Secured by Circle • PCI DSS Compliant"})]})]})})]})]})}}}]);