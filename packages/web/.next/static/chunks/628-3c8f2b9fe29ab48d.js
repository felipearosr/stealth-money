"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[628],{6682:(e,a,t)=>{t.d(a,{Z:()=>o});var s=t(4568),n=t(8421),c=t(9594),r=t(5945),l=t(5191);let i=[{key:"calculator",label:"Calculate",shortLabel:"Calc",icon:n.A,description:"Enter transfer amount"},{key:"recipient",label:"Recipient",shortLabel:"Recipient",icon:c.A,description:"Add recipient details"},{key:"payment",label:"Payment",shortLabel:"Pay",icon:r.A,description:"Complete payment"},{key:"status",label:"Status",shortLabel:"Status",icon:l.A,description:"Track transfer"}];function o(e){var a;let{currentStep:t,completedSteps:n,onStepClick:c}=e,r=i.findIndex(e=>e.key===t),o=(e,a)=>n.includes(e.key)?"completed":e.key===t?"current":a<r?"completed":"upcoming",d=(e,a)=>{let t="relative flex items-center justify-center w-10 h-10 rounded-full border-2 transition-all duration-200",s=a?"cursor-pointer hover:scale-105":"";switch(e){case"completed":return"".concat(t," ").concat(s," bg-green-500 border-green-500 text-white");case"current":return"".concat(t," ").concat(s," bg-blue-500 border-blue-500 text-white ring-4 ring-blue-100");default:return"".concat(t," bg-gray-100 border-gray-300 text-gray-400")}},m=e=>{let a=e<r||n.includes(i[e].key);return"flex-1 h-0.5 mx-2 transition-colors duration-300 ".concat(a?"bg-green-500":"bg-gray-300")},u=e=>{c&&(n.includes(e.key)||e.key===t)&&c(e.key)};return(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsx)("div",{className:"hidden md:block",children:(0,s.jsx)("div",{className:"flex items-center justify-between",children:i.map((e,a)=>{let c=o(e,a),r=n.includes(e.key)||e.key===t,x=e.icon;return(0,s.jsxs)("div",{className:"flex items-center flex-1",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:d(c,r),onClick:()=>u(e),role:r?"button":void 0,tabIndex:r?0:void 0,onKeyDown:a=>{r&&("Enter"===a.key||" "===a.key)&&(a.preventDefault(),u(e))},children:"completed"===c?(0,s.jsx)(l.A,{className:"w-5 h-5"}):(0,s.jsx)(x,{className:"w-5 h-5"})}),(0,s.jsxs)("div",{className:"mt-2 text-center",children:[(0,s.jsx)("div",{className:"text-sm font-medium ".concat("current"===c?"text-blue-600":"completed"===c?"text-green-600":"text-gray-500"),children:e.label}),(0,s.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:e.description})]})]}),a<i.length-1&&(0,s.jsx)("div",{className:m(a)})]},e.key)})})}),(0,s.jsxs)("div",{className:"md:hidden",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-4",children:i.map((e,a)=>{let c=o(e,a),m=n.includes(e.key)||e.key===t,x=e.icon;return(0,s.jsxs)("div",{className:"flex items-center flex-1",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:d(c,m),onClick:()=>u(e),role:m?"button":void 0,tabIndex:m?0:void 0,onKeyDown:a=>{m&&("Enter"===a.key||" "===a.key)&&(a.preventDefault(),u(e))},children:"completed"===c?(0,s.jsx)(l.A,{className:"w-4 h-4"}):(0,s.jsx)(x,{className:"w-4 h-4"})}),(0,s.jsx)("div",{className:"mt-1 text-center",children:(0,s.jsx)("div",{className:"text-xs font-medium ".concat("current"===c?"text-blue-600":"completed"===c?"text-green-600":"text-gray-500"),children:e.shortLabel})})]}),a<i.length-1&&(0,s.jsx)("div",{className:"flex-1 h-0.5 mx-1 ".concat(a<r||n.includes(i[a].key)?"bg-green-500":"bg-gray-300")})]},e.key)})}),(0,s.jsx)("div",{className:"text-center",children:(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["Step ",r+1," of ",i.length,": ",null==(a=i[r])?void 0:a.description]})})]}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[(0,s.jsx)("span",{children:"Progress"}),(0,s.jsxs)("span",{children:[Math.round((r+1)/i.length*100),"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-green-500 h-2 rounded-full transition-all duration-500 ease-out",style:{width:"".concat((r+1)/i.length*100,"%")}})})]})]})}},8477:(e,a,t)=>{t.d(a,{Y:()=>u});var s=t(4568),n=t(7620),c=t(9513),r=t(7469),l=t(7277),i=t(5191),o=t(9690),d=t(3353),m=t(7227);function u(e){let{transferId:a,onRefresh:t,autoRefresh:u=!0,refreshInterval:x=5e3}=e,[h,f]=(0,n.useState)(null),[p,b]=(0,n.useState)(!0),[g,y]=(0,n.useState)(null),[N,j]=(0,n.useState)(new Date),[v,w]=(0,n.useState)(!1),A=async function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];try{e&&b(!0),y(null);let t=await fetch("".concat("http://localhost:4000","/api/transfers/").concat(a,"/status"));if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.message||"Failed to fetch transfer status")}let s=await t.json();f(s),j(new Date),w(!0)}catch(e){console.error("Transfer status fetch error:",e),y(e instanceof Error?e.message:"Failed to fetch transfer status"),w(!1)}finally{e&&b(!1)}},k=()=>{A(!0),t&&t()};(0,n.useEffect)(()=>{A(!0)},[a]),(0,n.useEffect)(()=>{if(u&&h&&"completed"!==h.status&&"failed"!==h.status){let e=setInterval(()=>{A(!1)},x);return()=>clearInterval(e)}},[u,x,null==h?void 0:h.status]);let C=(e,a)=>new Intl.NumberFormat("en-US",{style:"currency",currency:a,minimumFractionDigits:2,maximumFractionDigits:2}).format(e),B=e=>new Date(e).toLocaleString(),S=e=>{switch(e){case"success":return{color:"text-green-600",icon:i.A};case"pending":return{color:"text-yellow-600",icon:c.A};case"failed":return{color:"text-red-600",icon:o.A};default:return{color:"text-gray-600",icon:c.A}}};if(p&&!h)return(0,s.jsx)(d.Zp,{className:"w-full max-w-2xl mx-auto",children:(0,s.jsxs)(d.Wu,{className:"flex items-center justify-center py-8",children:[(0,s.jsx)(r.A,{className:"h-6 w-6 animate-spin text-muted-foreground mr-2"}),(0,s.jsx)("span",{className:"text-muted-foreground",children:"Loading transfer status..."})]})});if(g&&!h)return(0,s.jsx)(d.Zp,{className:"w-full max-w-2xl mx-auto",children:(0,s.jsx)(d.Wu,{className:"py-8",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(o.A,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-red-700 mb-2",children:"Error Loading Transfer"}),(0,s.jsx)("p",{className:"text-red-600 mb-4",children:g}),(0,s.jsxs)(m.$,{onClick:k,variant:"outline",children:[(0,s.jsx)(r.A,{className:"h-4 w-4 mr-2"}),"Try Again"]})]})})});if(!h)return(0,s.jsx)(d.Zp,{className:"w-full max-w-2xl mx-auto",children:(0,s.jsx)(d.Wu,{className:"py-8",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(o.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Transfer Not Found"}),(0,s.jsxs)("p",{className:"text-gray-600",children:["No transfer data available for ID: ",a]})]})})});let X=(e=>{switch(e){case"initiated":return{color:"text-blue-600",bgColor:"bg-blue-50",icon:c.A,label:"Initiated"};case"payment_processing":return{color:"text-yellow-600",bgColor:"bg-yellow-50",icon:r.A,label:"Processing Payment"};case"transferring":return{color:"text-blue-600",bgColor:"bg-blue-50",icon:l.A,label:"Transferring"};case"paying_out":return{color:"text-purple-600",bgColor:"bg-purple-50",icon:r.A,label:"Paying Out"};case"completed":return{color:"text-green-600",bgColor:"bg-green-50",icon:i.A,label:"Completed"};case"failed":return{color:"text-red-600",bgColor:"bg-red-50",icon:o.A,label:"Failed"};default:return{color:"text-gray-600",bgColor:"bg-gray-50",icon:c.A,label:"Unknown"}}})(h.status),T=X.icon,M=(e=>{switch(e){case"initiated":return 20;case"payment_processing":return 40;case"transferring":return 60;case"paying_out":return 80;case"completed":return 100;default:return 0}})(h.status);return(0,s.jsxs)(d.Zp,{className:"w-full max-w-2xl mx-auto shadow-sm",children:[(0,s.jsxs)(d.aR,{className:"pb-4",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[(0,s.jsxs)(d.ZB,{className:"flex items-center gap-2 text-lg",children:[(0,s.jsx)(T,{className:"h-5 w-5 ".concat(X.color)}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Transfer Status"}),(0,s.jsx)("span",{className:"sm:hidden",children:"Status"})]}),(0,s.jsxs)(m.$,{onClick:k,variant:"outline",size:"sm",disabled:p,className:"self-start sm:self-auto",children:[(0,s.jsx)(r.A,{className:"h-4 w-4 mr-2 ".concat(p?"animate-spin":"")}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Refresh"}),(0,s.jsx)("span",{className:"sm:hidden",children:"Update"})]})]}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground break-all sm:break-normal",children:["ID: ",h.transferId]})]}),(0,s.jsxs)(d.Wu,{className:"space-y-6",children:[(0,s.jsx)("div",{className:"rounded-lg p-4 ".concat(X.bgColor),children:(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(T,{className:"h-6 w-6 ".concat(X.color)}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold ".concat(X.color),children:X.label}),h.estimatedCompletion&&"completed"!==h.status&&(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Estimated completion: ",B(h.estimatedCompletion)]}),h.completedAt&&(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Completed: ",B(h.completedAt)]})]})]})})}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm text-muted-foreground",children:[(0,s.jsx)("span",{children:"Progress"}),(0,s.jsxs)("span",{children:[M,"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"h-2 rounded-full transition-all duration-500 ".concat("failed"===h.status?"bg-red-500":"bg-blue-500"),style:{width:"".concat(M,"%")}})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"You sent"}),(0,s.jsx)("p",{className:"font-semibold",children:C(h.sendAmount,"USD")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Recipient gets"}),(0,s.jsx)("p",{className:"font-semibold text-green-600",children:C(h.receiveAmount,"EUR")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Exchange rate"}),(0,s.jsxs)("p",{className:"font-semibold",children:["1 USD = ",h.exchangeRate.toFixed(4)," EUR"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Fees"}),(0,s.jsx)("p",{className:"font-semibold",children:C(h.fees,"USD")})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"font-semibold",children:"Timeline"}),v&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-xs text-green-600",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Live updates"]})]}),(0,s.jsx)("div",{className:"relative",children:0===h.timeline.length?(0,s.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,s.jsx)(c.A,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,s.jsx)("p",{children:"No timeline events yet"})]}):(0,s.jsx)("div",{className:"space-y-4",children:h.timeline.map((e,a)=>{let t=S(e.status),n=t.icon,c=a===h.timeline.length-1,r=new Date(e.timestamp)>new Date(Date.now()-3e5);return(0,s.jsxs)("div",{className:"flex items-start gap-3 p-3 rounded-lg transition-all duration-300 ".concat(r?"bg-blue-50 border border-blue-200":"hover:bg-gray-50"),children:[(0,s.jsxs)("div",{className:"flex flex-col items-center relative",children:[(0,s.jsx)("div",{className:"p-1 rounded-full ".concat("success"===e.status?"bg-green-100":"pending"===e.status?"bg-yellow-100":"bg-red-100"),children:(0,s.jsx)(n,{className:"h-4 w-4 ".concat(t.color)})}),!c&&(0,s.jsx)("div",{className:"w-px h-8 mt-2 ".concat("success"===e.status?"bg-green-300":"bg-gray-300")})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1",children:[(0,s.jsx)("p",{className:"font-medium text-sm sm:text-base",children:e.message}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[r&&(0,s.jsx)("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:"New"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:B(e.timestamp)})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,s.jsx)("p",{className:"text-xs capitalize font-medium ".concat(t.color),children:e.status}),e.metadata&&Object.keys(e.metadata).length>0&&(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"• Additional details available"})]})]})]},e.id)})})})]}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground text-center border-t pt-4",children:["Last updated: ",B(h.lastUpdated),u&&"completed"!==h.status&&"failed"!==h.status&&(0,s.jsxs)("span",{className:"ml-2",children:["• Auto-refreshing every ",x/1e3,"s"]})]})]})]})}},8867:(e,a,t)=>{t.d(a,{A:()=>B});var s=t(4568),n=t(7620),c=t(6181),r=t(3353),l=t(7227),i=t(5165),o=t(2555),d=t(4675),m=t(4148),u=t(5191),x=t(9690),h=t(6678),f=t(9388),p=t(8262),b=t(4529),g=t(8442),y=t(5945),N=t(3367),j=t(7469),v=t(9513);function w(e){var a;let{account:t,onVerificationComplete:d,onSkip:h}=e,{getToken:f}=(0,c.d)(),[p,b]=(0,n.useState)(null),[g,y]=(0,n.useState)(!1),[w,A]=(0,n.useState)(null),[k,C]=(0,n.useState)(null),[B,S]=(0,n.useState)(["",""]),[X,T]=(0,n.useState)("pending");(0,n.useEffect)(()=>{"micro_deposits"===t.verificationMethod&&t.verificationStartedAt&&(b("micro_deposits"),T("deposits_sent"))},[t]);let M=async()=>{y(!0),A(null);try{let e=await f(),a=await fetch("".concat("http://localhost:4000","/api/users/me/bank-accounts/").concat(t.id,"/verify/micro-deposits"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.message||"Failed to start verification")}b("micro_deposits"),T("deposits_sent"),C("Micro-deposits have been sent to your account. They will appear within 1-2 business days.")}catch(e){console.error("Micro-deposit verification error:",e),A(e instanceof Error?e.message:"Failed to start verification")}finally{y(!1)}},E=async()=>{if(!B[0]||!B[1])return void A("Please enter both deposit amounts");y(!0),A(null),T("verifying");try{let e=await f(),a=await fetch("".concat("http://localhost:4000","/api/users/me/bank-accounts/").concat(t.id,"/verify/micro-deposits/confirm"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({amounts:B.map(e=>parseFloat(e))})});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.message||"Verification failed")}T("verified"),C("Account verified successfully!"),setTimeout(()=>{d(t.id)},2e3)}catch(e){console.error("Micro-deposit confirmation error:",e),A(e instanceof Error?e.message:"Verification failed"),T("failed")}finally{y(!1)}},F=async()=>{y(!0),A(null);try{C("Instant verification would launch here (Plaid integration)"),setTimeout(()=>{d(t.id)},3e3)}catch(e){console.error("Instant verification error:",e),A("Instant verification is not available for this account")}finally{y(!1)}},I=e=>{switch(e){case"micro_deposits":return{name:"Micro-Deposits",description:"We send small deposits to verify account ownership",icon:(0,s.jsx)(N.A,{className:"h-5 w-5"})};case"instant":return{name:"Instant Verification",description:"Connect securely through your online banking",icon:(0,s.jsx)(u.A,{className:"h-5 w-5"})};default:return{name:"Unknown",description:"Unknown verification method",icon:(0,s.jsx)(x.A,{className:"h-5 w-5"})}}},P=()=>(0,s.jsxs)("div",{className:"text-center space-y-4",children:[(0,s.jsx)(u.A,{className:"h-16 w-16 text-green-500 mx-auto"}),(0,s.jsx)("h3",{className:"text-xl font-semibold text-green-700",children:"Account Verified!"}),(0,s.jsxs)("p",{className:"text-gray-600",children:["Your ",t.bankName," account has been successfully verified. You can now send and receive money."]}),(0,s.jsxs)(m.E,{className:"bg-green-100 text-green-800",children:["Verified ",t.verificationMethod&&I(t.verificationMethod).name]})]});return(0,s.jsxs)(r.Zp,{className:"w-full max-w-2xl mx-auto",children:[(0,s.jsxs)(r.aR,{children:[(0,s.jsx)(r.ZB,{className:"flex items-center space-x-2",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[t.isVerified?(0,s.jsx)(u.A,{className:"h-5 w-5 text-green-500"}):(0,s.jsx)(v.A,{className:"h-5 w-5 text-yellow-500"}),(0,s.jsxs)("span",{children:[t.accountName," (",t.currency,")"]})]})}),(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:[t.bankName," • ",t.accountHolderName]})]}),(0,s.jsxs)(r.Wu,{className:"space-y-6",children:[w&&(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 text-red-700",children:[(0,s.jsx)(x.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"font-medium",children:"Verification Error"})]}),(0,s.jsx)("p",{className:"text-red-600 mt-1",children:w})]}),k&&(0,s.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 text-green-700",children:[(0,s.jsx)(u.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"font-medium",children:"Success"})]}),(0,s.jsx)("p",{className:"text-green-600 mt-1",children:k})]}),t.isVerified?P():"failed"===X?(0,s.jsxs)("div",{className:"text-center space-y-4",children:[(0,s.jsx)(x.A,{className:"h-16 w-16 text-red-500 mx-auto"}),(0,s.jsx)("h3",{className:"text-xl font-semibold text-red-700",children:"Verification Failed"}),(0,s.jsx)("p",{className:"text-gray-600",children:"The amounts you entered don't match our records. Please check your account statement and try again."}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Attempts remaining: ",3-t.verificationFailures]}),(0,s.jsxs)("div",{className:"flex space-x-3 justify-center",children:[(0,s.jsx)(l.$,{onClick:()=>{T("deposits_sent"),S(["",""]),A(null)},disabled:t.verificationFailures>=3,children:"Try Again"}),t.verificationFailures>=3&&(0,s.jsx)(l.$,{variant:"outline",onClick:()=>b(null),children:"Choose Different Method"})]})]}):"deposits_sent"===X?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"text-center mb-6",children:[(0,s.jsx)(u.A,{className:"h-12 w-12 text-green-500 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Micro-Deposits Sent"}),(0,s.jsxs)("p",{className:"text-gray-600",children:["We've sent 2 small deposits to your ",t.bankName," account ending in ",(null==(a=t.accountNumber)?void 0:a.slice(-4))||"****","."]}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Check your account statement and enter the exact amounts below."})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(o.J,{htmlFor:"deposit1",children:"First Deposit Amount"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"$"}),(0,s.jsx)(i.p,{id:"deposit1",type:"number",step:"0.01",min:"0",max:"1",placeholder:"0.XX",className:"pl-8",value:B[0],onChange:e=>S([e.target.value,B[1]])})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(o.J,{htmlFor:"deposit2",children:"Second Deposit Amount"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"$"}),(0,s.jsx)(i.p,{id:"deposit2",type:"number",step:"0.01",min:"0",max:"1",placeholder:"0.XX",className:"pl-8",value:B[1],onChange:e=>S([B[0],e.target.value])})]})]})]}),(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsx)(l.$,{onClick:E,disabled:g||!B[0]||!B[1],className:"flex-1",children:g?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Verifying..."]}):"Verify Account"}),(0,s.jsx)(l.$,{variant:"outline",onClick:()=>{b(null),T("pending"),S(["",""])},children:"Back"})]}),(0,s.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm",children:(0,s.jsxs)("p",{className:"text-blue-800",children:[(0,s.jsx)("strong",{children:"Can't find the deposits?"}),' They may take up to 2 business days to appear. Look for deposits from "Stealth Money" or "SM Verify" in your transaction history.']})})]}):"verified"===X?P():(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"text-center mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Verify Your Bank Account"}),(0,s.jsx)("p",{className:"text-gray-600",children:"To send and receive money, we need to verify that you own this account."})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(r.Zp,{className:"cursor-pointer hover:shadow-md transition-shadow border-2 hover:border-blue-200",onClick:()=>!g&&M(),children:(0,s.jsx)(r.Wu,{className:"p-4",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)(N.A,{className:"h-6 w-6 text-green-600"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h4",{className:"font-semibold",children:"Micro-Deposits (Recommended)"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"We'll send 2 small deposits (under $1) to your account. Verify the amounts to complete setup."}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Takes 1-2 business days • Most secure method"})]})]})})}),(0,s.jsx)(r.Zp,{className:"cursor-pointer hover:shadow-md transition-shadow border-2 hover:border-blue-200",onClick:()=>!g&&F(),children:(0,s.jsx)(r.Wu,{className:"p-4",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)(u.A,{className:"h-6 w-6 text-blue-600"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h4",{className:"font-semibold",children:"Instant Verification"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Connect through your online banking for immediate verification."}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Instant setup • Powered by Plaid"})]}),(0,s.jsx)(m.E,{variant:"secondary",className:"text-xs",children:"Coming Soon"})]})})})]})]}),h&&!t.isVerified&&"pending"===X&&(0,s.jsx)("div",{className:"pt-4 border-t",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"You can verify this account later, but you won't be able to send or receive money until it's verified."}),(0,s.jsx)(l.$,{variant:"outline",onClick:h,children:"Skip for Now"})]})})]})]})}let A={CL:{countryCode:"CL",countryName:"Chile",currency:"CLP",flag:"\uD83C\uDDE8\uD83C\uDDF1",banks:[{id:"cl-001",name:"Banco de Chile",code:"001"},{id:"cl-012",name:"Banco del Estado (BancoEstado)",code:"012"},{id:"cl-016",name:"Banco de Cr\xe9dito e Inversiones (BCI)",code:"016"},{id:"cl-037",name:"Banco Santander Chile",code:"037"},{id:"cl-039",name:"Banco Ita\xfa Chile",code:"039"},{id:"cl-049",name:"Banco Security",code:"049"},{id:"cl-051",name:"Banco Falabella",code:"051"},{id:"cl-053",name:"Banco Ripley",code:"053"},{id:"cl-054",name:"Banco Consorcio",code:"054"},{id:"cl-055",name:"Banco BICE",code:"055"},{id:"cl-504",name:"Scotiabank Chile",code:"504"}],accountTypes:[{value:"checking",label:"Cuenta Corriente"},{value:"savings",label:"Cuenta de Ahorro"},{value:"vista",label:"Cuenta Vista"},{value:"rut",label:"Cuenta RUT (BancoEstado)"}],requiredFields:[{field:"rut",label:"RUT del Titular",type:"text",placeholder:"12.345.678-9",validation:"Chilean RUT",maxLength:12},{field:"accountNumber",label:"N\xfamero de Cuenta",type:"text",placeholder:"0123456789",maxLength:20}]},US:{countryCode:"US",countryName:"United States",currency:"USD",flag:"\uD83C\uDDFA\uD83C\uDDF8",banks:[{id:"us-boa",name:"Bank of America",code:"BOFAUS3N",swift:"BOFAUS3N"},{id:"us-chase",name:"JPMorgan Chase",code:"CHASUS33",swift:"CHASUS33"},{id:"us-wells",name:"Wells Fargo",code:"WFBIUS6S",swift:"WFBIUS6S"},{id:"us-citi",name:"Citibank",code:"CITIUS33",swift:"CITIUS33"},{id:"us-pnc",name:"PNC Bank",code:"PNCCUS33",swift:"PNCCUS33"},{id:"us-usbank",name:"U.S. Bank",code:"USBKUS44",swift:"USBKUS44"},{id:"us-capital",name:"Capital One",code:"HIBKUS44",swift:"HIBKUS44"},{id:"us-td",name:"TD Bank",code:"NRTHUS33",swift:"NRTHUS33"},{id:"us-regions",name:"Regions Bank",code:"UPNBUS44",swift:"UPNBUS44"},{id:"us-fifth",name:"Fifth Third Bank",code:"FTBCUS3C",swift:"FTBCUS3C"}],accountTypes:[{value:"checking",label:"Checking Account"},{value:"savings",label:"Savings Account"},{value:"money_market",label:"Money Market Account"}],requiredFields:[{field:"routingNumber",label:"Routing Number (ABA)",type:"text",placeholder:"123456789",validation:"US Routing Number",maxLength:9},{field:"accountNumber",label:"Account Number",type:"text",placeholder:"1234567890",maxLength:17}]},DE:{countryCode:"DE",countryName:"Germany",currency:"EUR",flag:"\uD83C\uDDE9\uD83C\uDDEA",banks:[{id:"de-deutsche",name:"Deutsche Bank",code:"DEUTDEFF",swift:"DEUTDEFF"},{id:"de-commerzbank",name:"Commerzbank",code:"COBADEFF",swift:"COBADEFF"},{id:"de-dkb",name:"DKB (Deutsche Kreditbank)",code:"BYLADEM1",swift:"BYLADEM1"},{id:"de-postbank",name:"Postbank",code:"PBNKDEFF",swift:"PBNKDEFF"},{id:"de-sparkasse",name:"Sparkasse",code:"VARIES",swift:"VARIES"},{id:"de-volksbank",name:"Volksbank",code:"VARIES",swift:"VARIES"},{id:"de-hypovereins",name:"HypoVereinsbank",code:"HYVEDEMMXXX",swift:"HYVEDEMMXXX"}],accountTypes:[{value:"girokonto",label:"Girokonto (Checking)"},{value:"sparkonto",label:"Sparkonto (Savings)"},{value:"tagesgeld",label:"Tagesgeldkonto (Daily Savings)"}],requiredFields:[{field:"iban",label:"IBAN",type:"text",placeholder:"DE89 3704 0044 0532 0130 00",validation:"IBAN",maxLength:34}]},ES:{countryCode:"ES",countryName:"Spain",currency:"EUR",flag:"\uD83C\uDDEA\uD83C\uDDF8",banks:[{id:"es-santander",name:"Banco Santander",code:"BSCHESMMXXX",swift:"BSCHESMMXXX"},{id:"es-bbva",name:"BBVA",code:"BBVAESMMXXX",swift:"BBVAESMMXXX"},{id:"es-caixa",name:"CaixaBank",code:"CAIXESBBXXX",swift:"CAIXESBBXXX"},{id:"es-sabadell",name:"Banco Sabadell",code:"BSABESBBXXX",swift:"BSABESBBXXX"},{id:"es-bankinter",name:"Bankinter",code:"BKBKESMMXXX",swift:"BKBKESMMXXX"},{id:"es-unicaja",name:"Unicaja Banco",code:"UCJAES2MXXX",swift:"UCJAES2MXXX"}],accountTypes:[{value:"corriente",label:"Cuenta Corriente"},{value:"ahorro",label:"Cuenta de Ahorro"},{value:"nomina",label:"Cuenta N\xf3mina"}],requiredFields:[{field:"iban",label:"IBAN",type:"text",placeholder:"ES91 2100 0418 4502 0005 1332",validation:"IBAN",maxLength:34}]},FR:{countryCode:"FR",countryName:"France",currency:"EUR",flag:"\uD83C\uDDEB\uD83C\uDDF7",banks:[{id:"fr-bnp",name:"BNP Paribas",code:"BNPAFRPPXXX",swift:"BNPAFRPPXXX"},{id:"fr-credit-agricole",name:"Cr\xe9dit Agricole",code:"AGRIFRPPXXX",swift:"AGRIFRPPXXX"},{id:"fr-societe",name:"Soci\xe9t\xe9 G\xe9n\xe9rale",code:"SOGEFRPPXXX",swift:"SOGEFRPPXXX"},{id:"fr-credit-mutuel",name:"Cr\xe9dit Mutuel",code:"CMCIFRPPXXX",swift:"CMCIFRPPXXX"},{id:"fr-banque-postale",name:"La Banque Postale",code:"PSSTFRPPXXX",swift:"PSSTFRPPXXX"},{id:"fr-lcl",name:"LCL",code:"CRLYFRPPXXX",swift:"CRLYFRPPXXX"}],accountTypes:[{value:"courant",label:"Compte Courant"},{value:"epargne",label:"Compte \xc9pargne"},{value:"livret_a",label:"Livret A"}],requiredFields:[{field:"iban",label:"IBAN",type:"text",placeholder:"FR14 2004 1010 0505 0001 3M02 606",validation:"IBAN",maxLength:34}]},IT:{countryCode:"IT",countryName:"Italy",currency:"EUR",flag:"\uD83C\uDDEE\uD83C\uDDF9",banks:[{id:"it-unicredit",name:"UniCredit",code:"UNCRITMMXXX",swift:"UNCRITMMXXX"},{id:"it-intesa",name:"Intesa Sanpaolo",code:"BCITITMM",swift:"BCITITMM"},{id:"it-mps",name:"Monte dei Paschi di Siena",code:"PASCITMMXXX",swift:"PASCITMMXXX"},{id:"it-bnl",name:"BNL (BNP Paribas)",code:"BNLIITRR",swift:"BNLIITRR"},{id:"it-banco-bpm",name:"Banco BPM",code:"BAPPIT21",swift:"BAPPIT21"}],accountTypes:[{value:"corrente",label:"Conto Corrente"},{value:"risparmio",label:"Conto di Risparmio"},{value:"deposito",label:"Conto Deposito"}],requiredFields:[{field:"iban",label:"IBAN",type:"text",placeholder:"IT60 X054 2811 1010 0000 0123 456",validation:"IBAN",maxLength:34}]},MX:{countryCode:"MX",countryName:"Mexico",currency:"MXN",flag:"\uD83C\uDDF2\uD83C\uDDFD",banks:[{id:"mx-bbva",name:"BBVA M\xe9xico",code:"012",swift:"BCMRMXMM"},{id:"mx-santander",name:"Santander M\xe9xico",code:"014",swift:"BMSXMXMM"},{id:"mx-banamex",name:"Citibanamex",code:"002",swift:"BNMXMXMM"},{id:"mx-banorte",name:"Banorte",code:"072",swift:"MENOMXMT"},{id:"mx-hsbc",name:"HSBC M\xe9xico",code:"021",swift:"BIMEMXMM"},{id:"mx-scotiabank",name:"Scotiabank",code:"044",swift:"MBCOMXMM"},{id:"mx-inbursa",name:"Inbursa",code:"036",swift:"INBUMXMM"},{id:"mx-azteca",name:"Banco Azteca",code:"127",swift:"AZTKMXMM"}],accountTypes:[{value:"checking",label:"Cuenta de Cheques"},{value:"savings",label:"Cuenta de Ahorro"},{value:"payroll",label:"Cuenta de N\xf3mina"}],requiredFields:[{field:"clabe",label:"CLABE",type:"text",placeholder:"012345678901234567",validation:"CLABE",maxLength:18}]},GB:{countryCode:"GB",countryName:"United Kingdom",currency:"GBP",flag:"\uD83C\uDDEC\uD83C\uDDE7",banks:[{id:"gb-hsbc",name:"HSBC UK",code:"HBUKGB4B",swift:"HBUKGB4B"},{id:"gb-barclays",name:"Barclays",code:"BUKBGB22",swift:"BUKBGB22"},{id:"gb-lloyds",name:"Lloyds Bank",code:"LOYDGB2L",swift:"LOYDGB2L"},{id:"gb-natwest",name:"NatWest",code:"NWBKGB2L",swift:"NWBKGB2L"},{id:"gb-santander",name:"Santander UK",code:"ABBYGB2L",swift:"ABBYGB2L"},{id:"gb-halifax",name:"Halifax",code:"HLFXGB21",swift:"HLFXGB21"},{id:"gb-nationwide",name:"Nationwide",code:"NAIAGB21",swift:"NAIAGB21"},{id:"gb-metro",name:"Metro Bank",code:"MYMBGB2L",swift:"MYMBGB2L"}],accountTypes:[{value:"current",label:"Current Account"},{value:"savings",label:"Savings Account"},{value:"isa",label:"ISA Account"}],requiredFields:[{field:"sortCode",label:"Sort Code",type:"text",placeholder:"12-34-56",validation:"UK Sort Code",maxLength:8},{field:"accountNumber",label:"Account Number",type:"text",placeholder:"12345678",validation:"UK Account Number",maxLength:8}]}};function k(e){let a;if(!e||"string"!=typeof e)return!1;let t=e.replace(/[\.\-\s]/g,"").toUpperCase();if(t.length<8||t.length>9)return!1;let s=t.slice(0,-1),n=t.slice(-1);if(!/^\d+$/.test(s)||!/^[0-9K]$/.test(n))return!1;let c=0,r=2;for(let e=s.length-1;e>=0;e--)c+=parseInt(s[e])*r,r=7===r?2:r+1;let l=11-c%11;return n===(11===l?"0":10===l?"K":l.toString())}function C(e){let{onComplete:a,onSkip:t,requireVerification:N=!1,onAccountAdded:j}=e,{getToken:v}=(0,c.d)(),[C,B]=(0,n.useState)([]),[S,X]=(0,n.useState)(!0),[T,M]=(0,n.useState)(!1),[E,F]=(0,n.useState)(null),[I,P]=(0,n.useState)(!1),[U,R]=(0,n.useState)(""),[L,D]=(0,n.useState)(null),[V,H]=(0,n.useState)({accountName:"",country:"",bankId:"",accountHolderName:"",accountType:"",isPrimary:!1}),[G,K]=(0,n.useState)({}),[O,q]=(0,n.useState)(""),[$,Y]=(0,n.useState)(null),W=U?A[U]:null,Z=async()=>{try{let e=await v(),a=await fetch("".concat("http://localhost:4000","/api/users/me/bank-accounts"),{headers:{Authorization:"Bearer ".concat(e)}});if(a.ok){let e=await a.json(),t=e.bankAccounts||e;B(Array.isArray(t)?t:[])}else B([])}catch(e){console.error("Error fetching bank accounts:",e),B([])}finally{X(!1)}};(0,n.useEffect)(()=>{Z()},[]);let _=()=>{let e={};if(V.accountName.trim()||(e.accountName="Account name is required"),U||(e.country="Please select a country"),L||(e.bankId="Please select a bank"),V.accountHolderName.trim()||(e.accountHolderName="Account holder name is required"),V.accountType||(e.accountType="Account type is required"),W)for(let a of W.requiredFields){let t=V[a.field];if(!t||"string"!=typeof t||!t.trim()){e[a.field]="".concat(a.label," is required");continue}switch(a.validation){case"Chilean RUT":k(t)||(e[a.field]=function(e){var a;if(!e||""===e.trim())return"RUT es requerido";let t=(a=e)&&"string"==typeof a?a.replace(/[\.\-\s]/g,"").toUpperCase():"";if(t.length<7)return"RUT debe tener al menos 7 d\xedgitos";if(t.length>9)return"RUT no puede tener m\xe1s de 9 caracteres";let s=t.slice(0,-1),n=t.slice(-1);return/^\d+$/.test(s)?/^[0-9K]$/.test(n)?k(e)?"RUT no es v\xe1lido":"D\xedgito verificador no es v\xe1lido":"D\xedgito verificador debe ser un n\xfamero del 0-9 o K":"RUT debe contener solo n\xfameros antes del d\xedgito verificador"}(t));break;case"IBAN":!function(e){let a=e.replace(/\s/g,"").toUpperCase();if(!/^[A-Z]{2}[0-9]{2}[A-Z0-9]+$/.test(a))return!1;let t={DE:22,ES:24,FR:27,IT:27,GB:22},s=a.substring(0,2);return!t[s]||a.length===t[s]}(t)&&(e[a.field]="Invalid IBAN format");break;case"CLABE":!function(e){let a=e.replace(/\s/g,"");return!!/^\d{18}$/.test(a)}(t)&&(e[a.field]="CLABE must be 18 digits");break;case"US Routing Number":/^\d{9}$/.test(t)||(e[a.field]="Routing number must be 9 digits");break;case"UK Sort Code":!function(e){let a=e.replace(/-/g,"");return/^\d{6}$/.test(a)}(t)&&(e[a.field]="Sort code must be 6 digits")}}return K(e),0===Object.keys(e).length},z=async e=>{if(e.preventDefault(),_()&&L&&W){P(!0);try{let e=await v(),a={accountName:V.accountName,currency:W.currency,country:U,bankName:L.name,bankCode:L.code,accountHolderName:V.accountHolderName,accountType:V.accountType,isPrimary:V.isPrimary};W.requiredFields.forEach(e=>{V[e.field]&&(a[e.field]=V[e.field])});let t=E?"".concat("http://localhost:4000","/api/users/me/bank-accounts/").concat(E.id):"".concat("http://localhost:4000","/api/users/me/bank-accounts"),s=E?"PUT":"POST",n=await fetch(t,{method:s,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(a)});if(n.ok){let e=await n.json();console.log("Bank account created successfully:",e),await Z(),Q(),M(!1),F(null),q("✅ ".concat(e.bankName," account added successfully! Verification required to start sending money.")),setTimeout(()=>q(""),5e3),j&&j(),console.log("Bank account creation completed, form closed")}else{let e=await n.json();console.error("Failed to save bank account:",e),K({general:e.message||"Failed to save bank account"})}}catch(e){console.error("Error saving bank account:",e),K({general:"Failed to save bank account. Please try again."})}finally{P(!1)}}},J=async e=>{if(confirm("Are you sure you want to delete this bank account?"))try{let a=await v();(await fetch("".concat("http://localhost:4000","/api/users/me/bank-accounts/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(a)}})).ok?await Z():console.error("Failed to delete bank account")}catch(e){console.error("Error deleting bank account:",e)}},Q=()=>{R(""),D(null),H({accountName:"",country:"",bankId:"",accountHolderName:"",accountType:"",isPrimary:!1}),K({}),q("")},ee=e=>{let a=e.country,t=A[a],s=null==t?void 0:t.banks.find(a=>a.code===e.bankCode);R(a),D(s||null);let n={accountName:e.accountName,country:a,bankId:(null==s?void 0:s.id)||"",accountHolderName:e.accountHolderName,accountType:e.accountType||"",isPrimary:e.isPrimary};e.iban&&(n.iban=e.iban),e.accountNumber&&(n.accountNumber=e.accountNumber),e.routingNumber&&(n.routingNumber=e.routingNumber),e.rut&&(n.rut=e.rut),e.clabe&&(n.clabe=e.clabe),e.sortCode&&(n.sortCode=e.sortCode),e.ukAccountNumber&&(n.ukAccountNumber=e.ukAccountNumber),H(n),F(e),M(!0)},ea=Array.isArray(C)&&C.some(e=>e.isVerified),et=Array.isArray(C)&&C.length>0&&!ea,es=async e=>{console.log("Verification completed for account:",e),Y(null),await Z();let t=await fetch("".concat("http://localhost:4000","/api/users/me/bank-accounts"),{headers:{Authorization:"Bearer ".concat(await v())}});if(t.ok){let e=await t.json(),s=e.bankAccounts||e;Array.isArray(s)&&s.some(e=>e.isVerified)&&a&&(console.log("All requirements met, calling onComplete"),a())}};return S?(0,s.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):$?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Verify Bank Account"}),(0,s.jsxs)("p",{className:"text-gray-600",children:["Complete verification for ",$.bankName," to start sending money."]})]}),(0,s.jsx)(w,{account:$,onVerificationComplete:es,onSkip:()=>Y(null)}),(0,s.jsx)(l.$,{variant:"outline",onClick:()=>Y(null),children:"← Back to Account List"})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-2",children:et?"Verify Your Bank Account":"Bank Account Setup"}),(0,s.jsx)("p",{className:"text-gray-600",children:et?"Complete bank account verification to start sending money globally.":"Add and verify your bank accounts to start sending money globally."})]}),O&&(0,s.jsx)(r.Zp,{className:"border-green-200 bg-green-50",children:(0,s.jsx)(r.Wu,{className:"py-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(u.A,{className:"h-5 w-5 text-green-600"}),(0,s.jsx)("span",{className:"font-medium text-green-700",children:O})]})})}),et&&(0,s.jsx)(r.Zp,{className:"border-blue-200 bg-blue-50",children:(0,s.jsx)(r.Wu,{className:"py-6",children:(0,s.jsxs)("div",{className:"text-center space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,s.jsx)(x.A,{className:"h-6 w-6 text-blue-600"}),(0,s.jsx)("span",{className:"text-lg font-semibold text-blue-700",children:"Bank Account Added Successfully!"})]}),(0,s.jsx)("p",{className:"text-blue-600",children:'Your account has been added but needs verification to send money. Click "Verify Account" below to start the verification process.'})]})})}),Array.isArray(C)&&C.length>0&&(0,s.jsx)(r.Zp,{className:ea?"border-green-200 bg-green-50":"border-amber-200 bg-amber-50",children:(0,s.jsx)(r.Wu,{className:"py-4",children:(0,s.jsx)("div",{className:"flex items-center gap-2",children:ea?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.A,{className:"h-5 w-5 text-green-600"}),(0,s.jsxs)("span",{className:"font-medium text-green-700",children:["You have ",C.filter(e=>e.isVerified).length," verified account(s)"]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.A,{className:"h-5 w-5 text-amber-600"}),(0,s.jsx)("span",{className:"font-medium text-amber-700",children:"Verification required for your bank account(s)"})]})})})}),Array.isArray(C)&&C.length>0&&(0,s.jsx)("div",{className:"space-y-3",children:C.map(e=>{var a;return(0,s.jsx)(r.Zp,{className:"relative",children:(0,s.jsx)(r.Wu,{className:"py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(h.A,{className:"h-8 w-8 text-gray-400"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("h4",{className:"font-semibold",children:e.accountName}),e.isPrimary&&(0,s.jsx)(m.E,{variant:"secondary",children:"Primary"}),(0,s.jsx)(m.E,{variant:e.isVerified?"default":"outline",children:e.isVerified?"Verified":"Pending"})]}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[e.bankName," • ",e.currency," •","checking"===e.accountType?" Checking":" Savings"]}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:null==(a=A[e.country])?void 0:a.countryName}),!e.isVerified&&(0,s.jsxs)("p",{className:"text-xs text-amber-600 mt-1 flex items-center gap-1",children:[(0,s.jsx)(x.A,{className:"h-3 w-3"}),"Verification required to send money"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[!e.isVerified&&(0,s.jsx)(l.$,{variant:"outline",size:"sm",className:"border-blue-500 text-blue-600 hover:bg-blue-50",onClick:()=>{Y(e)},children:"Verify Account"}),(0,s.jsx)(l.$,{variant:"ghost",size:"sm",onClick:()=>ee(e),children:(0,s.jsx)(f.A,{className:"h-4 w-4"})}),(0,s.jsx)(l.$,{variant:"ghost",size:"sm",onClick:()=>J(e.id),children:(0,s.jsx)(p.A,{className:"h-4 w-4 text-red-500"})})]})]})})},e.id)})}),!T&&(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsxs)(l.$,{onClick:()=>{Q(),M(!0)},className:"flex-1",variant:et?"ghost":"outline",children:[(0,s.jsx)(b.A,{className:"h-4 w-4 mr-2"}),et?"Add Another Account":"Add Bank Account"]}),t&&!N&&!et&&(0,s.jsx)(l.$,{onClick:t,variant:"ghost",children:"Skip for now"})]}),T&&(0,s.jsxs)(r.Zp,{children:[(0,s.jsxs)(r.aR,{children:[(0,s.jsx)(r.ZB,{children:E?"Edit Bank Account":"Add New Bank Account"}),(0,s.jsx)(r.BT,{children:"Select your country first, then choose your bank and provide account details."})]}),(0,s.jsx)(r.Wu,{children:(0,s.jsxs)("form",{onSubmit:z,className:"space-y-6",children:[G.general&&(0,s.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:(0,s.jsx)("p",{className:"text-sm text-red-600",children:G.general})}),(0,s.jsxs)("div",{className:"space-y-4 p-4 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[(0,s.jsx)(g.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"Step 1: Select Your Country"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(o.J,{htmlFor:"country",children:"Country"}),(0,s.jsxs)(d.l6,{value:U,onValueChange:e=>{var a;R(e),D(null);let t=A[e];H({accountName:"",country:e,bankId:"",accountHolderName:"",accountType:(null==t||null==(a=t.accountTypes[0])?void 0:a.value)||"",isPrimary:!Array.isArray(C)||0===C.length}),K({})},children:[(0,s.jsx)(d.bq,{className:G.country?"border-red-500":"",children:(0,s.jsx)(d.yv,{placeholder:"Choose your country"})}),(0,s.jsx)(d.gC,{children:Object.values(A).sort((e,a)=>e.countryName.localeCompare(a.countryName)).map(e=>(0,s.jsx)(d.eb,{value:e.countryCode,children:(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{children:e.flag}),(0,s.jsx)("span",{children:e.countryName}),(0,s.jsxs)("span",{className:"text-gray-500",children:["(",e.currency,")"]})]})},e.countryCode))})]}),G.country&&(0,s.jsx)("p",{className:"text-sm text-red-500 mt-1",children:G.country})]})]}),U&&W&&(0,s.jsxs)("div",{className:"space-y-4 p-4 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[(0,s.jsx)(h.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"Step 2: Select Your Bank"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(o.J,{htmlFor:"bank",children:"Bank"}),(0,s.jsxs)(d.l6,{value:V.bankId,onValueChange:e=>{W&&(D(W.banks.find(a=>a.id===e)||null),H(a=>({...a,bankId:e})))},children:[(0,s.jsx)(d.bq,{className:G.bankId?"border-red-500":"",children:(0,s.jsx)(d.yv,{placeholder:"Choose your bank"})}),(0,s.jsx)(d.gC,{children:W.banks.map(e=>(0,s.jsx)(d.eb,{value:e.id,children:e.name},e.id))})]}),G.bankId&&(0,s.jsx)("p",{className:"text-sm text-red-500 mt-1",children:G.bankId})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(o.J,{htmlFor:"accountType",children:"Account Type"}),(0,s.jsxs)(d.l6,{value:V.accountType,onValueChange:e=>H(a=>({...a,accountType:e})),children:[(0,s.jsx)(d.bq,{className:G.accountType?"border-red-500":"",children:(0,s.jsx)(d.yv,{placeholder:"Select account type"})}),(0,s.jsx)(d.gC,{children:W.accountTypes.map(e=>(0,s.jsx)(d.eb,{value:e.value,children:e.label},e.value))})]}),G.accountType&&(0,s.jsx)("p",{className:"text-sm text-red-500 mt-1",children:G.accountType})]})]}),L&&W&&(0,s.jsxs)("div",{className:"space-y-4 p-4 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[(0,s.jsx)(y.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"Step 3: Account Details"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(o.J,{htmlFor:"accountName",children:"Account Nickname"}),(0,s.jsx)(i.p,{id:"accountName",value:V.accountName,onChange:e=>H(a=>({...a,accountName:e.target.value})),placeholder:"e.g., My Chilean Account",className:G.accountName?"border-red-500":""}),G.accountName&&(0,s.jsx)("p",{className:"text-sm text-red-500 mt-1",children:G.accountName})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(o.J,{htmlFor:"accountHolderName",children:"Account Holder Name"}),(0,s.jsx)(i.p,{id:"accountHolderName",value:V.accountHolderName,onChange:e=>H(a=>({...a,accountHolderName:e.target.value})),placeholder:"Full name as it appears on the account",className:G.accountHolderName?"border-red-500":""}),G.accountHolderName&&(0,s.jsx)("p",{className:"text-sm text-red-500 mt-1",children:G.accountHolderName})]}),W?W.requiredFields.map(e=>(0,s.jsxs)("div",{children:[(0,s.jsx)(o.J,{htmlFor:e.field,children:e.label}),(0,s.jsx)(i.p,{id:e.field,type:e.type,value:V[e.field]||"",onChange:a=>{let t=a.target.value;"rut"===e.field?t=function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1],!e)return"";let a=e.replace(/[^0-9K]/gi,"").toUpperCase().slice(0,9);if(a.length>=2){let e=a.slice(0,-1),t=a.slice(-1),s=e.replace(/\B(?=(\d{3})+(?!\d))/g,".");return"".concat(s,"-").concat(t)}return a}(t,V[e.field]||""):"sortCode"===e.field&&(t=function(e){let a=e.replace(/-/g,"");return a.length>=4?"".concat(a.slice(0,2),"-").concat(a.slice(2,4),"-").concat(a.slice(4,6)):a}(t)),H(a=>({...a,[e.field]:t}))},placeholder:e.placeholder,maxLength:e.maxLength,className:G[e.field]?"border-red-500":""}),G[e.field]&&(0,s.jsx)("p",{className:"text-sm text-red-500 mt-1",children:G[e.field]})]},e.field)):null,Array.isArray(C)&&C.length>0&&(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"checkbox",id:"isPrimary",checked:V.isPrimary,onChange:e=>H(a=>({...a,isPrimary:e.target.checked})),className:"rounded border-gray-300"}),(0,s.jsxs)(o.J,{htmlFor:"isPrimary",className:"text-sm font-normal",children:["Set as primary account for ",W.currency]})]})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)(l.$,{type:"submit",disabled:I,className:"flex-1",children:I?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):E?"Update Account":"Add Account"}),(0,s.jsx)(l.$,{type:"button",variant:"outline",onClick:()=>{M(!1),F(null),Q()},children:"Cancel"})]})]})})]})]})}function B(e){let{children:a,requireVerification:t=!1,onOnboardingComplete:r,skipCheckOnPublicPages:l=!1,blockTransfersUntilVerified:i=!1}=e,{getToken:o}=(0,c.d)(),[d,m]=(0,n.useState)(!0),[u,x]=(0,n.useState)(!1),[h,f]=(0,n.useState)([]);(0,n.useEffect)(()=>{l?(m(!1),x(!1)):p()},[l]);let p=async()=>{try{m(!0);let e=await o();if(!e)return void x(!1);let a=new AbortController,s=setTimeout(()=>a.abort(),5e3);try{let n=await fetch("".concat("http://localhost:4000","/api/users/me/bank-accounts"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},signal:a.signal});if(clearTimeout(s),n.ok){let e=await n.json();console.log("OnboardingGate: Fetched response:",e);let a=e.bankAccounts||e,s=Array.isArray(a)?a:[];f(s);let c=s.length>0,r=s.some(e=>e.isVerified);if(console.log("OnboardingGate: Has accounts:",c,"Has verified:",r),t||i){let e=!r;console.log("OnboardingGate: Transfer flow - needs onboarding:",e),x(e)}else{let e=!c;console.log("OnboardingGate: Regular flow - needs onboarding:",e),x(e)}}else 401===n.status||console.warn("Onboarding status check failed:",n.status,n.statusText),x(!1)}catch(e){throw clearTimeout(s),e}}catch(e){e instanceof Error&&"AbortError"===e.name?console.warn("Onboarding status check timed out (API may be slow or unavailable)"):console.warn("Onboarding status check error (API may not be running):",e),x(!1)}finally{m(!1)}};return d?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[200px]",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Checking account status..."})]})}):u?(0,s.jsx)(C,{onComplete:()=>{console.log("OnboardingGate: Onboarding completed, refreshing status..."),p(),r&&r()},onSkip:t||i?void 0:()=>{i||x(!1)},requireVerification:t||i,onAccountAdded:()=>{console.log("OnboardingGate: Account added, refreshing status..."),p()}}):(0,s.jsx)(s.Fragment,{children:a})}}}]);