"use strict";exports.id=560,exports.ids=[560],exports.modules={9431:(e,s,a)=>{a.d(s,{A:()=>r});let r=(0,a(84667).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},31461:(e,s,a)=>{a.d(s,{A:()=>r});let r=(0,a(84667).A)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},34560:(e,s,a)=>{a.d(s,{E:()=>w});var r=a(13486),t=a(49933),c=a(60159),l=a(74941),n=a(29563),i=a(23025),d=a(41571),x=a(20276),m=a(57956),h=a(63821),o=a(83991),u=a(21800),j=a(23365),p=a(86e3),y=a(97493),N=a(9431);let f=(0,a(84667).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);var g=a(15577),v=a(15998),b=a(31461),C=a(63859);function w({transferData:e,onRecipientSelected:s,onBack:a,currentUserId:w,isLoading:A=!1}){let[k,S]=(0,c.useState)(""),[P,L]=(0,c.useState)([]),[F,$]=(0,c.useState)(!1),[R,Z]=(0,c.useState)(null),[E,M]=(0,c.useState)(!1),[D,W]=(0,c.useState)([]),[T,U]=(0,c.useState)(!1),[B,z]=(0,c.useState)(null),[q,I]=(0,c.useState)(null),[V,Y]=(0,c.useState)(null),[H,J]=(0,c.useState)("recent"),O=(0,c.useCallback)(async()=>"",[]);(0,c.useCallback)(async()=>{if(w){U(!0),z(null);try{let e=await fetch("http://localhost:4000/api/users/me/recipients",{headers:{Authorization:`Bearer ${await O()}`,"Content-Type":"application/json"}});if(!e.ok)throw Error("Failed to load recent recipients");let s=await e.json();W(s.recipients||[])}catch(e){console.error("Error loading recent recipients:",e),z("Failed to load recent recipients"),W([])}finally{U(!1)}}},[w,O]),(0,c.useCallback)(async s=>{$(!0),Z(null);try{let a=new URLSearchParams({q:s,currency:e.receiveCurrency,limit:"10"});"CLP"===e.receiveCurrency&&a.append("country","CL");let r=await fetch(`http://localhost:4000/api/users/search?${a}`,{headers:{Authorization:`Bearer ${await O()}`,"Content-Type":"application/json"}});if(!r.ok)throw Error("Failed to search users");let t=(await r.json()).users.filter(s=>s.id!==w&&("CLP"!==e.receiveCurrency||s.verifiedPaymentMethods.some(e=>"CLP"===e.currency&&"CL"===e.country)));L(t),M(!0)}catch(e){console.error("Error searching users:",e),Z("Failed to search users. Please try again."),L([])}finally{$(!1)}},[e.receiveCurrency,w,O]);let _=s=>{I(s);let a=s.verifiedPaymentMethods.filter(s=>s.currency===e.receiveCurrency),r=a.find(e=>e.isDefault)||a[0];r&&Y(r)},G=e=>{Y(e)},K=(s,a=!1,c)=>{let l=s.verifiedPaymentMethods.filter(s=>s.currency===e.receiveCurrency),i=q?.id===s.id,d="CLP"===e.receiveCurrency,p=d?(0,C.formatChileanUserDisplay)(s):null;return(0,r.jsx)(n.Zp,{className:`cursor-pointer transition-all hover:shadow-md ${i?"ring-2 ring-blue-500 bg-blue-50":""}`,onClick:()=>_(s),children:(0,r.jsx)(n.Wu,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:s.profileImageUrl?(0,r.jsx)(t.default,{src:s.profileImageUrl,alt:p?.displayName||s.fullName,width:48,height:48,className:"w-12 h-12 rounded-full object-cover"}):(0,r.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center",children:(0,r.jsx)(m.A,{className:"w-6 h-6 text-gray-500"})})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:p?.displayName||s.fullName}),s.isVerified&&(0,r.jsx)(h.A,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),a&&c?.isFavorite&&(0,r.jsx)(o.A,{className:"w-4 h-4 text-yellow-500 flex-shrink-0"})]}),(p?.subtitle||s.email||s.username)&&(0,r.jsx)("div",{className:"flex items-center space-x-4 text-xs text-gray-500 mb-2",children:p?.subtitle?(0,r.jsx)("span",{className:"truncate",children:p.subtitle}):(0,r.jsxs)(r.Fragment,{children:[s.email&&(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)(u.A,{className:"w-3 h-3"}),(0,r.jsx)("span",{className:"truncate",children:s.email})]}),s.username&&(0,r.jsx)("div",{className:"flex items-center space-x-1",children:(0,r.jsxs)("span",{children:["@",s.username]})})]})}),a&&c&&(0,r.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500 mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)(j.A,{className:"w-3 h-3"}),(0,r.jsxs)("span",{children:["Last: ",new Date(c.lastTransferAt).toLocaleDateString()]})]}),(0,r.jsxs)("div",{children:[c.transferCount," transfer",1!==c.transferCount?"s":""]})]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-1 mb-2",children:d&&p?.badges?p.badges.map((e,s)=>(0,r.jsx)(x.E,{variant:e.includes("CLP")?"default":"secondary",className:"text-xs",children:e},s)):s.supportedCurrencies.map(s=>(0,r.jsx)(x.E,{variant:s===e.receiveCurrency?"default":"secondary",className:"text-xs",children:s},s))}),l.length>0?(0,r.jsxs)("div",{className:"text-xs text-green-600",children:["✓ ",l.length," verified account",1!==l.length?"s":""," for ",e.receiveCurrency,d&&(0,r.jsx)("span",{className:"ml-1",children:"(Chilean bank)"})]}):(0,r.jsxs)("div",{className:"text-xs text-red-600",children:["✗ No verified accounts for ",e.receiveCurrency,d&&(0,r.jsx)("span",{className:"ml-1",children:"(Need Chilean bank account)"})]})]})]})})},s.id)};return(0,r.jsxs)("div",{className:"w-full max-w-4xl mx-auto space-y-6",children:[(0,r.jsx)(n.Zp,{children:(0,r.jsxs)(n.aR,{children:[(0,r.jsxs)(n.ZB,{className:"flex items-center space-x-2",children:[(0,r.jsx)(N.A,{className:"h-5 w-5"}),(0,r.jsx)("span",{children:"Send to User"})]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Send ",e.sendAmount," ",e.sendCurrency," to a registered user"]})]})}),(0,r.jsx)(n.Zp,{className:"bg-gray-50",children:(0,r.jsxs)(n.Wu,{className:"p-4",children:[(0,r.jsx)("h3",{className:"font-semibold mb-2",children:"Transfer Summary"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"You Send:"}),(0,r.jsxs)("span",{className:"font-medium",children:[e.sendAmount," ",e.sendCurrency]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"They Receive:"}),(0,r.jsxs)("span",{className:"font-medium",children:[e.receiveAmount," ",e.receiveCurrency]})]}),(0,r.jsxs)("div",{className:"flex justify-between col-span-2",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Exchange Rate:"}),(0,r.jsxs)("span",{className:"font-medium",children:["1 ",e.sendCurrency," = ",e.exchangeRate.toFixed(4)," ",e.receiveCurrency]})]})]})]})}),(0,r.jsxs)("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[(0,r.jsxs)("button",{className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${"recent"===H?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,onClick:()=>J("recent"),children:[(0,r.jsx)(j.A,{className:"w-4 h-4 inline mr-2"}),"Recent Recipients"]}),(0,r.jsxs)("button",{className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${"search"===H?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,onClick:()=>J("search"),children:[(0,r.jsx)(f,{className:"w-4 h-4 inline mr-2"}),"Search Users"]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:["search"===H&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"user-search",children:"CLP"===e.receiveCurrency?"Search Chilean users by username, email, or phone":"Search by email, username, or phone"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(f,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,r.jsx)(i.p,{id:"user-search",placeholder:"CLP"===e.receiveCurrency?"Enter username, email, or phone number...":"Enter email, username, or phone number...",className:"pl-10",value:k,onChange:e=>S(e.target.value)}),F&&(0,r.jsx)(g.A,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 animate-spin text-gray-400"})]}),"CLP"===e.receiveCurrency&&(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Only showing Chilean users with verified CLP bank accounts"})]}),R&&(0,r.jsx)(n.Zp,{className:"border-red-200 bg-red-50",children:(0,r.jsx)(n.Wu,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-red-700",children:[(0,r.jsx)(p.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:R})]})})}),E&&!F&&0===P.length&&!R&&(0,r.jsx)(n.Zp,{children:(0,r.jsxs)(n.Wu,{className:"p-8 text-center",children:[(0,r.jsx)(N.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No users found"}),(0,r.jsx)("p",{className:"text-gray-600",children:"CLP"===e.receiveCurrency?`No Chilean users found matching "${k}" with verified CLP bank accounts. Try a different search term.`:`No users found matching "${k}". Try a different search term.`})]})}),P.length>0&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("h3",{className:"text-sm font-medium text-gray-700",children:["Search Results (",P.length,")"]}),P.map(e=>K(e))]})]}),"recent"===H&&(0,r.jsxs)(r.Fragment,{children:[B&&(0,r.jsx)(n.Zp,{className:"border-red-200 bg-red-50",children:(0,r.jsx)(n.Wu,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-red-700",children:[(0,r.jsx)(p.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:B})]})})}),T?(0,r.jsx)(n.Zp,{children:(0,r.jsxs)(n.Wu,{className:"p-8 text-center",children:[(0,r.jsx)(g.A,{className:"w-8 h-8 animate-spin text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading recent recipients..."})]})}):0===D.length?(0,r.jsx)(n.Zp,{children:(0,r.jsxs)(n.Wu,{className:"p-8 text-center",children:[(0,r.jsx)(j.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No recent recipients"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"You haven't sent money to any users yet. Use the search tab to find someone to send money to."}),(0,r.jsxs)(l.$,{variant:"outline",onClick:()=>J("search"),children:[(0,r.jsx)(f,{className:"w-4 h-4 mr-2"}),"Search Users"]})]})}):(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("h3",{className:"text-sm font-medium text-gray-700",children:["Recent Recipients (",D.length,")"]}),D.map(e=>K(e.userProfile,!0,e))]})]})]}),q&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Selected Recipient"}),K(q),(()=>{if(!q)return null;let s=q.verifiedPaymentMethods.filter(s=>s.currency===e.receiveCurrency);return 0===s.length?(0,r.jsx)(n.Zp,{className:"border-red-200 bg-red-50",children:(0,r.jsxs)(n.Wu,{className:"p-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-red-700",children:[(0,r.jsx)(p.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"font-medium",children:"No Compatible Payment Methods"})]}),(0,r.jsxs)("p",{className:"text-red-600 text-sm mt-1",children:[q.fullName," ","doesn't have any verified accounts that can receive"," ",e.receiveCurrency,"."]})]})}):(0,r.jsxs)(n.Zp,{children:[(0,r.jsxs)(n.aR,{children:[(0,r.jsx)(n.ZB,{className:"text-sm",children:"Select Payment Method"}),(0,r.jsxs)("p",{className:"text-xs text-gray-600",children:["Choose how ",q.fullName," should receive the ",e.receiveCurrency]})]}),(0,r.jsx)(n.Wu,{className:"space-y-2",children:s.map(e=>(0,r.jsx)("div",{className:`p-3 border rounded-lg cursor-pointer transition-all ${V?.id===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>G(e),children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(y.A,{className:"w-4 h-4 text-gray-500"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:"text-sm font-medium",children:e.bankName||`${e.type.replace("_"," ")}`}),e.isDefault&&(0,r.jsx)(x.E,{variant:"secondary",className:"text-xs",children:"Default"})]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[e.accountType," • ",e.currency," • ",e.country,e.lastFourDigits&&` • ****${e.lastFourDigits}`]}),(0,r.jsxs)("div",{className:"text-xs text-gray-400",children:["Verified ",new Date(e.verifiedAt).toLocaleDateString()]})]}),V?.id===e.id&&(0,r.jsx)(h.A,{className:"w-4 h-4 text-blue-500"})]})},e.id))})]})})()]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsxs)(l.$,{variant:"outline",onClick:a,disabled:A,children:[(0,r.jsx)(v.A,{className:"mr-2 h-4 w-4"}),"Back"]}),(0,r.jsx)(l.$,{onClick:()=>{q&&V&&s(q,V)},disabled:!q||!V||A,children:A?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):(0,r.jsxs)(r.Fragment,{children:["Continue to Payment",(0,r.jsx)(b.A,{className:"ml-2 h-4 w-4"})]})})]})]})}},83991:(e,s,a)=>{a.d(s,{A:()=>r});let r=(0,a(84667).A)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]])}};